    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Information for contributors &#8212; CoSMo Multivariate Pattern Analysis toolbox 1.0rc1 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0rc1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="Authors" href="thanks.html" />
    <link rel="prev" title="Contact information" href="contact.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="thanks.html" title="Authors"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="contact.html" title="Contact information"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CoSMoMVPA</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="documentation.html" accesskey="U">Documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="information-for-contributors">
<span id="contribute"></span><h1><a class="toc-backref" href="#id5">Information for contributors</a><a class="headerlink" href="#information-for-contributors" title="Permalink to this headline">¶</a></h1>
<p>We would be very happy to receive contributions!</p>
<p>You don&#8217;t have to be a <a class="reference external" href="http://www.mathworks.com/products/matlab/">Matlab</a> / <a class="reference external" href="https://www.gnu.org/software/octave/">Octave</a> programmer. Useful <em>code</em> contributions are very much appreciated, but improved documentation, ideas on how our web site can be made prettier, or other ideas are also valued highly.</p>
<p>If you are not a <a class="reference external" href="http://www.mathworks.com/products/matlab/">Matlab</a> / <a class="reference external" href="https://www.gnu.org/software/octave/">Octave</a> programmer but would like to contribute or suggest improvements on the documentation or examples, please <a class="reference external" href="contact.html">contact</a> us directly.</p>
<p>For programmers, the preferred way to contribute is using <a class="reference external" href="http://gitscm.com">git</a> and <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a>. If you would like to contribute code in another way, also please <a class="reference external" href="contact.html">contact</a> us directly.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#information-for-contributors" id="id5">Information for contributors</a><ul>
<li><a class="reference internal" href="#directory-locations-and-naming-conventions" id="id6">Directory locations and naming conventions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#information-for-contributing-programmers" id="id7">Information for contributing <em>programmers</em></a><ul>
<li><a class="reference internal" href="#code-development" id="id8">Code development</a></li>
<li><a class="reference internal" href="#build-system" id="id9">Build system</a></li>
<li><a class="reference internal" href="#matlab-code-guidelines" id="id10">Matlab code guidelines</a></li>
<li><a class="reference internal" href="#cosmomvpa-specific-guidelines" id="id11">CoSMoMVPA-specific guidelines</a></li>
<li><a class="reference internal" href="#test-suite" id="id12">Test suite</a></li>
<li><a class="reference internal" href="#good-tests" id="id13">Good tests</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="directory-locations-and-naming-conventions">
<span id="file-locations-and-naming-conventions"></span><h2><a class="toc-backref" href="#id6">Directory locations and naming conventions</a><a class="headerlink" href="#directory-locations-and-naming-conventions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="meta-naming-conventions-in-the-documentation">
<h3>Meta - naming conventions in the documentation<a class="headerlink" href="#meta-naming-conventions-in-the-documentation" title="Permalink to this headline">¶</a></h3>
<p>In what follows we use the following naming conventions.
- Path names are <a class="reference external" href="http://en.wikipedia.org/wiki/Unix-like">Unix-like</a>-based; <code class="docutils literal"><span class="pre">/</span></code> is the path separation character, rather than <code class="docutils literal"><span class="pre">\</span></code> used on Windows platforms.
- Directories have <code class="docutils literal"><span class="pre">/</span></code> as the last character, and are relative to the root directory where <a class="reference external" href="http://cosmomvpa.org">CoSMoMVPA</a> resides. For example, if CoSMoMVPA is located in <code class="docutils literal"><span class="pre">/Users/karen/git/CoSMoMVPA</span></code>, then <code class="docutils literal"><span class="pre">mvpa/</span></code> refers to <code class="docutils literal"><span class="pre">/Users/karen/git/CoSMoMVPA/mvpa</span></code>.</p>
</div>
<div class="section" id="setting-the-matlab-path">
<h3>Setting the <a class="reference external" href="http://www.mathworks.com/products/matlab/">Matlab</a> path<a class="headerlink" href="#setting-the-matlab-path" title="Permalink to this headline">¶</a></h3>
<p>To use <code class="docutils literal"><span class="pre">CoSMoMVPA</span></code> functionality, it is recommended to set the path using <a class="reference internal" href="matlab/cosmo_set_path.html#cosmo-set-path"><span class="std std-ref">cosmo set path</span></a>. Optionally run <code class="docutils literal"><span class="pre">savepath</span></code> afterwards if you want to store the new path, so that it is set the next time Matlab or Octave is started.</p>
<p>Alternatively the path can be set manually as follows:</p>
<ul>
<li><p class="first">add the <code class="docutils literal"><span class="pre">mvpa/</span></code> directory to the <a class="reference external" href="http://www.mathworks.com/products/matlab/">Matlab</a> path.</p>
</li>
<li><p class="first">also add <code class="docutils literal"><span class="pre">externals/</span></code> and its subdirectories to the <a class="reference external" href="http://www.mathworks.com/products/matlab/">Matlab</a> path.</p>
</li>
<li><dl class="first docutils">
<dt>do <em>not</em> add <code class="docutils literal"><span class="pre">examples/</span></code> or <code class="docutils literal"><span class="pre">tests</span></code> to the <a class="reference external" href="http://www.mathworks.com/products/matlab/">Matlab</a> path.</dt>
<dd><ul class="first last simple">
<li>To run examples, <code class="docutils literal"><span class="pre">cd</span></code> to <code class="docutils literal"><span class="pre">examples/</span></code> and run scripts from there.</li>
<li>To run unit tests, run <code class="docutils literal"><span class="pre">cosmo_run_tests</span></code> (this requires the <a class="reference external" href="http://www.mathworks.com/matlabcentral/fileexchange/22846-matlab-xunit-test-framework">xUnit</a> or <a class="reference external" href="https://github.com/MOxUnit/MOxUnit">MOxUnit</a> testing frameworks).</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="organization-of-files-and-directories">
<h3>Organization of files and directories<a class="headerlink" href="#organization-of-files-and-directories" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Core <code class="docutils literal"><span class="pre">CoSMoMVPA</span></code> Matlab functions are in <code class="docutils literal"><span class="pre">mvpa/</span></code>. File names should match the pattern <code class="docutils literal"><span class="pre">cosmo_*.m</span></code>.</p>
</li>
<li><p class="first">Runnable Matlab example scripts are in <code class="docutils literal"><span class="pre">examples/</span></code>. File names should match the pattern <code class="docutils literal"><span class="pre">run_*.m</span></code> or <code class="docutils literal"><span class="pre">demo_*.m</span></code>.</p>
</li>
<li><p class="first">Unit tests are in <code class="docutils literal"><span class="pre">tests/</span></code>. File names should match the pattern <code class="docutils literal"><span class="pre">test_*.m</span></code> for unit tests, and any other prefix for helper functionality.</p>
</li>
<li><p class="first">External libraries are in <code class="docutils literal"><span class="pre">external</span></code>.</p>
</li>
<li><dl class="first docutils">
<dt>Documentation is in <code class="docutils literal"><span class="pre">doc/source/</span></code>:</dt>
<dd><ul class="first last simple">
<li>Documentation files have the <code class="docutils literal"><span class="pre">.rst</span></code> extension and are formatted as <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>.</li>
<li>Exercises have the prefix <code class="docutils literal"><span class="pre">ex_</span></code>.</li>
<li>Other documentation files, unless automatically generated (see &#8216;build system&#8217; below), should not have the prefix <code class="docutils literal"><span class="pre">cosmo_</span></code> or <code class="docutils literal"><span class="pre">run_</span></code>, as running <code class="docutils literal"><span class="pre">make</span> <span class="pre">clean</span></code> in <code class="docutils literal"><span class="pre">doc/</span></code> will remove them.</li>
<li>Other file types, such as images, are stored in <code class="docutils literal"><span class="pre">doc/source/_static/</span></code>.</li>
<li>Generated matlab output files, using the <code class="docutils literal"><span class="pre">publish</span></code> functionality in <code class="docutils literal"><span class="pre">mvpa/cosmo_publish_run_scripts</span></code> (for developers only), are stored in <code class="docutils literal"><span class="pre">doc/source/_static/publish/</span></code>.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Example data is stored separately.</p>
</li>
</ul>
</div>
<div class="section" id="setting-up-the-documentation-build-system">
<span id="building-the-documentation"></span><h3>Setting up the documentation build system<a class="headerlink" href="#setting-up-the-documentation-build-system" title="Permalink to this headline">¶</a></h3>
<p>The documentation is built using <a class="reference external" href="http://sphinx-doc.org">Sphinx</a>, <a class="reference external" href="http://python.org">Python</a>, <a class="reference external" href="https://pypi.python.org/pypi/sphinxcontrib-matlabdomain">sphinxcontrib-matlabdomain</a>, <cite>sphinxcontrib-bibtex</cite> and customly written <a class="reference external" href="http://python.org">Python</a> code. Currently only Unix-like systems are supported; we have tested it on Linux and Mac OS. <a class="reference external" href="http://python.org">Python</a> is a required dependency; we have tested with with version 2.7. Building requires using a shell, for example <code class="docutils literal"><span class="pre">bash</span></code>.</p>
<p>Installation is easiest using <a class="reference external" href="https://pypi.python.org/pypi/setuptools">easy_install</a>. To install as root:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">easy_install</span> <span class="n">sphinx</span>
<span class="n">easy_install</span> <span class="o">-</span><span class="n">U</span> <span class="n">sphinxcontrib</span><span class="o">-</span><span class="n">matlabdomain</span>
<span class="n">easy_install</span> <span class="o">-</span><span class="n">U</span> <span class="n">sphinxcontrib</span><span class="o">-</span><span class="n">bibtex</span>
</pre></div>
</div>
<p>Installation as non-root requires creating a local directory in which the <a class="reference external" href="http://python.org">Python</a> packages are stored. To install these in <code class="docutils literal"><span class="pre">~/python-lib</span></code>, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd
mkdir python-lib
cd python-lib
export PYTHONPATH=${PYTHONPATH}:`pwd`
export PATH=${PATH}:`pwd`
easy_install --install-dir . sphinx
easy_install --install-dir . -U sphinxcontrib-matlabdomain
easy_install --install-dir . -U sphinxcontrib-bibtex
</pre></div>
</div>
<p>In this case, it is useful to add the <code class="docutils literal"><span class="pre">export</span></code>-commands to <code class="docutils literal"><span class="pre">~/.bash_profile</span></code> so that the paths are set automatically upon login.</p>
<dl class="docutils">
<dt>To build the documentation:</dt>
<dd><ul class="first last simple">
<li>(optionally) in <a class="reference external" href="http://www.mathworks.com/products/matlab/">Matlab</a>, <code class="docutils literal"><span class="pre">cd</span></code> to the     <code class="docutils literal"><span class="pre">mvpa/</span></code> directory, then run <code class="docutils literal"><span class="pre">cosmo_publish_run_scripts</span></code>. This generates the matlab output of the scripts in <code class="docutils literal"><span class="pre">examples/</span></code>.</li>
<li>On the terminal, <code class="docutils literal"><span class="pre">cd</span></code> to <code class="docutils literal"><span class="pre">doc/</span></code>, then run <code class="docutils literal"><span class="pre">make</span> <span class="pre">html</span></code>. (To clean previously built documentation, run <code class="docutils literal"><span class="pre">make</span> <span class="pre">clean</span></code> first).</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="information-for-contributing-programmers">
<h1><a class="toc-backref" href="#id7">Information for contributing <em>programmers</em></a><a class="headerlink" href="#information-for-contributing-programmers" title="Permalink to this headline">¶</a></h1>
<p>The remainder of this section is for those experienced in <strong>programming</strong>; it describes how others can make code contributions, explains how and where different parts of the toolbox are stored, and provides some developer guidelines. If in doubt, or if you have questions or comments, do not hesitate to <a class="reference external" href="contact.html">contact</a> us.</p>
<div class="section" id="code-development">
<span id="id1"></span><h2><a class="toc-backref" href="#id8">Code development</a><a class="headerlink" href="#code-development" title="Permalink to this headline">¶</a></h2>
<div class="section" id="contributing-using-git">
<h3>Contributing using git<a class="headerlink" href="#contributing-using-git" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>The <a class="reference external" href="http://gitscm.com">git</a> distributed version control system is used for code development. It has several advantages over just downloading the <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA/archive/master.zip">zip archive</a>:</dt>
<dd><ul class="first last simple">
<li>a distributed workflow: multiple people can work on the code simultaneously, and almost always their changes can be merged without conflicts. In the unlikely event of merge conflicts (when multiple people have changed the same code), these conflicts are resolved easly.</li>
<li>keeping track of individual contributions. Through <a class="reference external" href="http://gitscm.com">git</a> it is possible to see every change made, by anybody. It provides functionality similar to a time-machine, but with some kind of tagging: every change is annotated (see below). This allows anyone to see what was changed, when this happended, and by who.</li>
<li>code sharing on multiple computers: everyone has their own copy of the code, and can merge changes made by others.</li>
<li>maintaining multiple versions: through <em>branching</em> one can create multiple copies of the code, each which its own new features. This is very useful for new experimental features or bug-fixing without affecting the <em>prestine</em> master code. Once changes are considered ready for the master repository, they can be merged easily.</li>
</ul>
</dd>
</dl>
<p>The instructions below assume a unix-like platform, and the command below should be run on the terminal (for example in bash).</p>
<div class="section" id="initial-git-github-setup">
<span id="initial-git-setup"></span><h4>Initial <a class="reference external" href="http://gitscm.com">git</a> / <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a> setup<a class="headerlink" href="#initial-git-github-setup" title="Permalink to this headline">¶</a></h4>
<p>To get started with <a class="reference external" href="http://gitscm.com">git</a> and <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a> to allow for code contributions to CoSMoMVPA:</p>
<blockquote>
<div><ul>
<li><p class="first">set up a working installation of <a class="reference external" href="http://gitscm.com">git</a> (see <a class="reference external" href="http://git-scm.com/book/en/Getting-Started-Installing-Git">installing git</a>).</p>
</li>
<li><p class="first">tell git about your name and email address:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="k">global</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="s2">&quot;Your full name&quot;</span>
<span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="k">global</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="s2">&quot;your_email@the_domain.com&quot;</span>
</pre></div>
</div>
<p>By setting these options, all commits you make will have this information, so that everybody can identify who changed what.</p>
</li>
<li><p class="first">make an account on <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a>, if you have not done so.</p>
</li>
<li><p class="first">on the <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a> project page, <a class="reference external" href="https://help.github.com/articles/fork-a-repo">fork the repository</a>, and follow the instructions there.</p>
</li>
<li><p class="first">get a local copy of your forked repository: run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">karen</span><span class="o">/</span><span class="n">CoSMoMVPA</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>if <code class="docutils literal"><span class="pre">karen</span></code> is your github user name.</p>
</li>
<li><p class="first">change to the directory just created:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">CoSMoMVPA</span>
</pre></div>
</div>
</li>
<li><p class="first">tell git about the <cite>offical</cite> release, which we call <code class="docutils literal"><span class="pre">upstream</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">upstream</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">CoSMoMVPA</span><span class="o">/</span><span class="n">CoSMoMVPA</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="proposing-a-change-in-the-code-a-k-a-submitting-a-pull-request-pr">
<h4>Proposing a change in the code (a.k.a. submitting a Pull Request (PR)<a class="headerlink" href="#proposing-a-change-in-the-code-a-k-a-submitting-a-pull-request-pr" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">to update your repository to the latest official code, first make sure you are on the master branch, then pull the current code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="n">master</span>
<span class="n">git</span> <span class="n">pull</span> <span class="n">upstream</span> <span class="n">master</span>
</pre></div>
</div>
<p>(This assumes that added the remote <code class="docutils literal"><span class="pre">upstream</span></code> as described in the <a class="reference internal" href="#initial-git-setup"><span class="std std-ref">previous section</span></a>.)</p>
</li>
<li><p class="first">to add a new feature or provide a bugfix, start a new branch:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">my_awesome_new_feature</span>
</pre></div>
</div>
</li>
<li><p class="first">make the desired changes, then commit them. <a class="reference internal" href="#committing-notes"><span class="std std-ref">See below for details</span></a>.</p>
</li>
<li><p class="first">push these changes to <em>your</em> <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a> account:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">my_awesome_new_feature</span>
</pre></div>
</div>
</li>
<li><p class="first">go to your own github page, i.e. <code class="docutils literal"><span class="pre">https://github.com/karen/CoSMoMVPA</span></code> if your git user name is <code class="docutils literal"><span class="pre">karen</span></code>. Typically the <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a> webpage already mentions that a new branch was pushed, so just click on <cite>create pull request</cite>. Otherwise click <cite>pull requests</cite> in the right-hand bar, then click <cite>New pull request</cite>. Add a description to the pull request, and then submit it.</p>
<p>We&#8217;ll get back to you to review and discuss the code. Once the code is ready for the official master it will be merged. You should receive notifications by email when the code is discussed or merged.</p>
</li>
<li><p class="first">if you want go back to using code from the <code class="docutils literal"><span class="pre">master</span></code> branch (the <cite>official</cite> code), run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="n">master</span>
</pre></div>
</div>
<p>Keep in mind that the <code class="docutils literal"><span class="pre">master</span></code> branch is supposed to contain working, runnable code. Proposed changes, including experimental code and bug-fixes, should preferably be submitted in separate branches.</p>
</li>
</ul>
</div></blockquote>
<p>There are many great resources on using <a class="reference external" href="http://gitscm.com">git</a> on the web; a detailed explanation is beyond the scope of this documentation.</p>
</div>
<div class="section" id="notes-on-committing">
<span id="committing-notes"></span><h4>Notes on committing<a class="headerlink" href="#notes-on-committing" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Please review your changes before commiting them. Useful commands are <code class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></code> and <code class="docutils literal"><span class="pre">git</span> <span class="pre">diff</span></code>.</p>
</li>
<li><p class="first">Do <em>not</em> use <code class="docutils literal"><span class="pre">git</span> <span class="pre">-a</span></code>; instead manually add the (changes to) files individually. Preferably commits should be atomic, that is change just one feature.  For example if you changed a file at two places by (1) improving the documentation and (2) refactoring code used internally, then preferably you should make two commits. Using the tags below these could be <code class="docutils literal"><span class="pre">DOC:</span> <span class="pre">...</span></code> and <code class="docutils literal"><span class="pre">RF:</span> <span class="pre">...</span></code>.
- To add a new file <code class="docutils literal"><span class="pre">my_new_file.m</span></code>, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="n">my_new_file</span><span class="o">.</span><span class="n">m</span>
</pre></div>
</div>
<ul>
<li><p class="first">To commit changes to a file, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="o">-</span><span class="n">i</span>
</pre></div>
</div>
<p>then press <code class="docutils literal"><span class="pre">p</span></code> (for &#8216;patch&#8217;), indicate which files to patch, and press <code class="docutils literal"><span class="pre">y</span></code> or <code class="docutils literal"><span class="pre">n</span></code> for each meaningful &#8216;atomic&#8217; change, and <code class="docutils literal"><span class="pre">q</span></code> to quit. (Usually followed by <code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">...</span></code>).</p>
</li>
<li><p class="first">To view the history of previous commits, <code class="docutils literal"><span class="pre">gitk</span></code> is useful.</p>
</li>
<li><p class="first">Use the following tags (inspired by <a class="reference external" href="http://pymvpa.org">PyMVPA</a>) for commits:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ACK</span></code>: Acknowledge someone else. Acknowledgees should be placed between <code class="docutils literal"><span class="pre">#</span></code> characters, so that the build system can generate acknowledgements on the web page.</li>
<li><code class="docutils literal"><span class="pre">BF</span></code>: Bugfix. Preferably this comes also with a unit test (i.e., <code class="docutils literal"><span class="pre">BF+TST</span></code>) that checks whether the bug was indeed fixed. If the bug was fixed before the code was merged into the master branch, use <code class="docutils literal"><span class="pre">FT</span></code>.</li>
<li><code class="docutils literal"><span class="pre">BK</span></code>: Breaks existing functionality, or the signature of functions (changes in the number, or the meaning, of input and output arguments).</li>
<li><code class="docutils literal"><span class="pre">BLD</span></code>: Changes in the build system.</li>
<li><code class="docutils literal"><span class="pre">BIG</span></code>: Major change. Please use together with another tag.</li>
<li><code class="docutils literal"><span class="pre">CLN</span></code>: Cleanup of code or documentation. <code class="docutils literal"><span class="pre">SML</span></code> can be omitted.</li>
<li><code class="docutils literal"><span class="pre">DOC</span></code>: Change in documentation <em>of matlab code</em> (in <code class="docutils literal"><span class="pre">examples/</span></code>, <code class="docutils literal"><span class="pre">mvpa/</span></code>, <code class="docutils literal"><span class="pre">tests/</span></code>).</li>
<li><code class="docutils literal"><span class="pre">EXC</span></code>: Change in exercises. This could go together with <code class="docutils literal"><span class="pre">WEB</span></code> or <code class="docutils literal"><span class="pre">DOC</span></code>, and/or <code class="docutils literal"><span class="pre">RUN</span></code>.</li>
<li><code class="docutils literal"><span class="pre">FT</span></code>: (Fixed during testing) Fix bug caught by test before the code was merged into the master branch. These are issues that would be considered bugs if they had been merged into master before. Introduced February 2017.</li>
<li><code class="docutils literal"><span class="pre">MSC</span></code>: Miscellaneous changes, not covered by any of the other tags.</li>
<li><code class="docutils literal"><span class="pre">NF</span></code>: New feature or functionality.</li>
<li><code class="docutils literal"><span class="pre">OCTV</span></code>: Change in GNU Octave compatibility.</li>
<li><code class="docutils literal"><span class="pre">OPT</span></code>: Optimalization. It should be used when the new code runs faster or uses less memory.</li>
<li><code class="docutils literal"><span class="pre">RF</span></code>: Refactoring (changes in functions that do not affect their external behaviour).</li>
<li><code class="docutils literal"><span class="pre">RUN</span></code>: Change in runnable example scripts (in <code class="docutils literal"><span class="pre">examples/</span></code>).</li>
<li><code class="docutils literal"><span class="pre">SML</span></code>: Minor change. Can be without an explanation of what was changed.  Please use together with another tag.</li>
<li><code class="docutils literal"><span class="pre">STD</span></code>: Change to adhere better to coding standards. <code class="docutils literal"><span class="pre">SML</span></code> can be omitted.</li>
<li><code class="docutils literal"><span class="pre">TST</span></code>: Change in test functions (functions in <code class="docutils literal"><span class="pre">tests/</span></code>, or documentation tests).</li>
<li><code class="docutils literal"><span class="pre">WEB</span></code>: Changes affecting web site content (either documentation in <code class="docutils literal"><span class="pre">.rst</span></code> files, or other files such as images).</li>
</ul>
<p>Using these tags:</p>
<ul class="simple">
<li>allows others to quickly see what <em>kind of</em> changes were made</li>
<li>the web page build system to generate summary reports on the kind of changes automatically.</li>
<li>generate statistics on types of changes over type.</li>
</ul>
<p>Please describe what changes you made. The tags don&#8217;t have to name which files were changed, as <a class="reference external" href="http://gitscm.com">git</a> takes care of that.</p>
<p>Tags can be combined, as it may occur that multiple tags apply; use the <code class="docutils literal"><span class="pre">+</span></code>-character to concatenate them.</p>
<p>Examples:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">'ENH:</span> <span class="pre">support</span> <span class="pre">two-dimensional</span> <span class="pre">cell</span> <span class="pre">arrays</span> <span class="pre">as</span> <span class="pre">feature</span> <span class="pre">attributes'</span></code></li>
<li><code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">'RF:</span> <span class="pre">build</span> <span class="pre">a</span> <span class="pre">lookup</span> <span class="pre">table</span> <span class="pre">mapping</span> <span class="pre">all</span> <span class="pre">voxels</span> <span class="pre">to</span> <span class="pre">those</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">dataset</span></code></li>
<li><code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">'BF+TST:</span> <span class="pre">throw</span> <span class="pre">an</span> <span class="pre">error</span> <span class="pre">if</span> <span class="pre">partitions</span> <span class="pre">are</span> <span class="pre">not</span> <span class="pre">balanced;</span> <span class="pre">added</span> <span class="pre">unit</span> <span class="pre">test'</span></code></li>
<li><code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">'DOC+SML:</span> <span class="pre">fixed</span> <span class="pre">a</span> <span class="pre">typo'</span></code></li>
<li><code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">'BF+ACK:</span> <span class="pre">show</span> <span class="pre">error</span> <span class="pre">message</span> <span class="pre">when</span> <span class="pre">negative</span> <span class="pre">radius</span> <span class="pre">is</span> <span class="pre">provided.</span> <span class="pre">Thanks</span> <span class="pre">to</span> <span class="pre">#John</span> <span class="pre">Doe#</span> <span class="pre">and</span> <span class="pre">#Jane</span> <span class="pre">Doe#</span> <span class="pre">for</span> <span class="pre">bringing</span> <span class="pre">up</span> <span class="pre">this</span> <span class="pre">use</span> <span class="pre">case</span></code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="build-system">
<span id="id2"></span><h2><a class="toc-backref" href="#id9">Build system</a><a class="headerlink" href="#build-system" title="Permalink to this headline">¶</a></h2>
<p>The build system is used to generate documentation for the web site (or local use).</p>
<ul>
<li><p class="first">Matlab files do not require building.</p>
</li>
<li><dl class="first docutils">
<dt>Documentation is built as follows:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>all Matlab files in <code class="docutils literal"><span class="pre">mvpa/</span></code> and <code class="docutils literal"><span class="pre">examples/</span></code> are converted to <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> format using the <a class="reference external" href="http://python.org">Python</a> script <code class="docutils literal"><span class="pre">matlab2rst.py</span></code> in <code class="docutils literal"><span class="pre">source/</span></code>. This script generates three <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>  versions of all Matlab functions and example scripts:</dt>
<dd><ul class="first last simple">
<li>Full contents (no suffix), containing the full source code.</li>
<li>Header contents (suffix <code class="docutils literal"><span class="pre">_hdr</span></code>), containing only the header (i.e. the first line and every subsequent line until the first line that does not start with <code class="docutils literal"><span class="pre">%</span></code> (note: line continuation, explained below, is currently <em>not</em> supported).</li>
<li>Skeleton contents (suffix <code class="docutils literal"><span class="pre">_skl</span></code>), containing a skeleton of the source code. In the skeleton version, lines between a starting line <code class="docutils literal"><span class="pre">%</span> <span class="pre">&gt;&#64;&#64;&gt;</span></code> and ending line <code class="docutils literal"><span class="pre">%</span> <span class="pre">&lt;&#64;&#64;&lt;</span></code> is replaced by a text saying <code class="docutils literal"><span class="pre">%%%%</span> <span class="pre">Your</span> <span class="pre">code</span> <span class="pre">comes</span> <span class="pre">here</span> <span class="pre">%%%%</span></code>. Skeleton files are intended for exercises.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Both <code class="docutils literal"><span class="pre">.txt</span></code> files (with the raw contents preceded by an <code class="docutils literal"><span class="pre">include</span></code> statement) and <code class="docutils literal"><span class="pre">.rst</span></code> files (with a title and label) are generated; the latter contain <code class="docutils literal"><span class="pre">include</span></code> statements to include the former.</p>
</li>
<li><p class="first">the <code class="docutils literal"><span class="pre">Makefile</span></code> in <code class="docutils literal"><span class="pre">source/</span></code>, when used through <code class="docutils literal"><span class="pre">make</span> <span class="pre">html</span></code>, uses <code class="docutils literal"><span class="pre">mat2rst.py</span></code> to generate <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> Matlab files and then uses <a class="reference external" href="http://sphinx-doc.org">Sphinx</a> to convert these files to html.</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">build.sh</span></code> script builds the documentation and datasets.</p>
</li>
</ul>
<p><strong>Note:</strong> building the documentation, as described in the previous points, is currently supported on <a class="reference external" href="http://en.wikipedia.org/wiki/Unix-like">Unix-like</a> systems only, and requires additional dependencies (see <a class="reference external" href="download.html">download</a>).</p>
<ul class="simple">
<li>The  <code class="docutils literal"><span class="pre">mvpa/cosmo_publish_run_scripts.m</span></code> function generates the output from all the runnable examples in <code class="docutils literal"><span class="pre">examples/</span></code> as html files and puts them in <code class="docutils literal"><span class="pre">doc/source/_static/publish/</span></code>. This function is used to produce output for the web site.</li>
</ul>
</div>
<div class="section" id="matlab-code-guidelines">
<span id="id3"></span><h2><a class="toc-backref" href="#id10">Matlab code guidelines</a><a class="headerlink" href="#matlab-code-guidelines" title="Permalink to this headline">¶</a></h2>
<p>The following are guidelines, intended to improve:</p>
<ul class="simple">
<li>consistency in code layout across contributers, so that the final result is more consistent.</li>
<li>readability, so that less time is spent in understanding how the code works or what it does.</li>
<li>performance, so that execution time or memory usage is reduced.</li>
</ul>
<div class="contents local topic" id="id4">
<ul class="simple">
<li><a class="reference internal" href="#maximum-line-length-is-75-characters" id="id14">Maximum line length is 75 characters</a></li>
<li><a class="reference internal" href="#indentation-is-4-spaces-no-tabs" id="id15">Indentation is 4 spaces (no tabs)</a></li>
<li><a class="reference internal" href="#use-lower-case-letters-for-variable-names" id="id16">Use lower-case letters for variable names</a></li>
<li><a class="reference internal" href="#throw-an-informative-error-early" id="id17">Throw an (informative) error early</a></li>
<li><a class="reference internal" href="#do-not-repeat-yourself" id="id18">Do not repeat yourself</a></li>
<li><a class="reference internal" href="#write-in-normal-understandable-english" id="id19">Write in normal, understandable english</a></li>
<li><a class="reference internal" href="#document-functions" id="id20">Document functions</a></li>
<li><a class="reference internal" href="#pre-allocate-space-for-data" id="id21">Pre-allocate space for data</a></li>
<li><a class="reference internal" href="#use-vectorization" id="id22">Use vectorization</a></li>
<li><a class="reference internal" href="#use-clear-variable-names" id="id23">Use clear variable names</a></li>
<li><a class="reference internal" href="#avoid-side-effects" id="id24">Avoid side effects</a></li>
<li><a class="reference internal" href="#use-oncleanup-if-an-earlier-state-needs-to-be-reset" id="id25">Use onCleanup if an earlier state needs to be reset</a></li>
<li><a class="reference internal" href="#tests-should-not-require-user-interaction" id="id26">Tests should not require user interaction</a></li>
<li><a class="reference internal" href="#do-not-use-global-variables" id="id27">Do not use global variables</a></li>
<li><a class="reference internal" href="#avoid-long-and-complicated-expressions" id="id28">Avoid long and complicated expressions</a></li>
<li><a class="reference internal" href="#use-sprintf-or-fprint-when-formatting-strings" id="id29">Use <code class="docutils literal"><span class="pre">sprintf</span></code> or <code class="docutils literal"><span class="pre">fprint</span></code> when formatting strings</a></li>
<li><a class="reference internal" href="#avoid-using-eval" id="id30">Avoid using <code class="docutils literal"><span class="pre">eval</span></code></a></li>
<li><a class="reference internal" href="#minimize-using-try-and-catch" id="id31">Minimize using <code class="docutils literal"><span class="pre">try</span></code> and <code class="docutils literal"><span class="pre">catch</span></code></a></li>
<li><a class="reference internal" href="#no-private-functions" id="id32">No private functions</a></li>
<li><a class="reference internal" href="#no-file-duplication" id="id33">No file duplication</a></li>
<li><a class="reference internal" href="#check-input-arguments" id="id34">Check input arguments</a></li>
</ul>
</div>
<p><strong>Note</strong>: None of these guidelines are set in stone. Try to use common sense when considering not to follow them. Indeed, for each guideline there may be a good reason to deviate from it.</p>
<div class="section" id="maximum-line-length-is-75-characters">
<h3><a class="toc-backref" href="#id14">Maximum line length is 75 characters</a><a class="headerlink" href="#maximum-line-length-is-75-characters" title="Permalink to this headline">¶</a></h3>
<p>Try to keep line lengths limited to 75 characters, so that files can be viewed in a standard terminal window, possibly with scroll bars, without line breaks. (The Matlab editor shows a vertical line after the 75-th character). Use line continuation (<code class="docutils literal"><span class="pre">...</span></code> at the very end of the line) followed by indentation for the continued lines.</p>
<ul>
<li><p class="first">An exception to this rule is including URLs in documentation, because they allow for copy-pasting the URL directly.</p>
</li>
<li><p class="first">If a binary operator is used together with line continuation, put the operator before the line continuation.</p>
</li>
<li><p class="first">Lines should not end with whitespace.</p>
<blockquote>
<div><p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">my_output_data</span><span class="p">=</span><span class="n">my_awesome_function</span><span class="p">(</span><span class="n">first_argument</span><span class="p">,</span> <span class="n">second_argument</span><span class="p">,</span> <span class="n">third_argument</span><span class="p">,</span> <span class="n">fourth_argument</span><span class="p">,</span> <span class="n">fifth_argument</span><span class="p">,</span> <span class="n">sixth_argument</span><span class="p">);</span>

<span class="n">apply_mask</span><span class="p">=</span><span class="n">user_has_supplied_mask</span> <span class="c">...</span>
                <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">user_mask</span><span class="p">)</span> <span class="c">...</span>
                <span class="o">&amp;&amp;</span> <span class="n">sum</span><span class="p">(</span><span class="n">user_mask</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>

<span class="n">my_string</span><span class="p">=</span><span class="s">&#39;Nick was right (as he usually is) in stating that although the use of long expressions may sometimes seem unavoidable, the use of line continuations hardly ever is.&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">my_output_data</span><span class="p">=</span><span class="n">my_awesome_function</span><span class="p">(</span><span class="n">first_argument</span><span class="p">,</span> <span class="n">second_argument</span><span class="p">,</span><span class="c">...</span>
                                   <span class="n">third_argument</span><span class="p">,</span> <span class="n">fourth_argument</span><span class="p">,</span><span class="c">...</span>
                                   <span class="n">fifth_argument</span><span class="p">,</span> <span class="n">sixth_argument</span><span class="p">);</span>

<span class="n">apply_mask</span><span class="p">=</span><span class="n">user_has_supplied_mask</span> <span class="o">&amp;&amp;</span> <span class="c">...</span>
                <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">user_mask</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="c">...</span>
                <span class="n">sum</span><span class="p">(</span><span class="n">user_mask</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>

<span class="n">my_string</span><span class="p">=[</span><span class="s">&#39;Nick was right (as he usually is) in stating that &#39;</span><span class="c">...</span>
            <span class="s">&#39;although the use of long expressions may sometimes &#39;</span><span class="c">...</span>
            <span class="s">&#39;seem unavoidable, the use of line continuations &#39;</span><span class="c">...</span>
            <span class="s">&#39;hardly ever is.&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>(Yes, we break this rule occasionely.)</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="indentation-is-4-spaces-no-tabs">
<h3><a class="toc-backref" href="#id15">Indentation is 4 spaces (no tabs)</a><a class="headerlink" href="#indentation-is-4-spaces-no-tabs" title="Permalink to this headline">¶</a></h3>
<p>Indentation should be used for <cite>if-else-end</cite>, <cite>while</cite> and <cite>function</cite> blocks. Expressions of the form <code class="docutils literal"><span class="pre">if</span> <span class="pre">expr</span></code>, <code class="docutils literal"><span class="pre">else</span></code>, <code class="docutils literal"><span class="pre">elseif</span> <span class="pre">expr</span></code>, <code class="docutils literal"><span class="pre">var=function(var)</span></code>, <code class="docutils literal"><span class="pre">while</span> <span class="pre">expr</span></code>, and <code class="docutils literal"><span class="pre">end</span></code> should be on a single line, except for very short statements that either set a default value for an input argument or raise an exception. For consitency please use exactly four spaces for every indent level; no more, no less.</p>
<p>If this guideline and the previous one do not give you enough room to express yourself, then most likely you are overcomplicating things; consider rewriting the code and/or use subfunctions.</p>
<blockquote>
<div><p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">a</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="k">if</span> <span class="n">b</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span>
    <span class="n">d</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span> <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>r<span class="p">=</span><span class="nf">my_min3</span><span class="p">(</span>x,y,z<span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">y</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="n">x</span>
      <span class="n">r</span><span class="p">=</span><span class="n">z</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">r</span><span class="p">=</span><span class="n">x</span><span class="p">;</span>
    <span class="k">end</span>
  <span class="k">else</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="n">y</span>
      <span class="n">r</span><span class="p">=</span><span class="n">z</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">r</span><span class="p">=</span><span class="n">y</span><span class="p">;</span>
    <span class="k">end</span>
 <span class="k">end</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">my_awesome_function</span><span class="p">(</span><span class="n">some_input</span><span class="p">,</span> <span class="n">more_input</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">,</span> <span class="n">the_array_value</span><span class="p">(:)=</span><span class="mi">42</span><span class="p">;</span> <span class="k">else</span> <span class="n">other_array_value</span><span class="p">(:)=</span><span class="mi">31</span><span class="p">;</span> <span class="k">end</span>
</pre></div>
</div>
<p><strong>acceptable:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">nargin</span><span class="o">&lt;</span><span class="mi">2</span> <span class="o">||</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">more_input</span><span class="p">),</span> <span class="n">more_input</span><span class="p">=</span><span class="mi">42</span><span class="p">;</span> <span class="k">end</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">nsamples</span><span class="o">~=</span><span class="n">ntrain</span><span class="p">,</span> <span class="n">error</span><span class="p">(</span><span class="s">&#39;Size mismatch: %d ~= %d&#39;</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">ntrain</span><span class="p">);</span> <span class="k">end</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">my_awesome_function</span><span class="p">(</span><span class="n">some_input</span><span class="p">,</span> <span class="n">more_input</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">100</span>
    <span class="n">the_array_value</span><span class="p">(:)=</span><span class="mi">42</span><span class="p">;</span>
<span class="k">else</span>
    <span class="n">other_array_value</span><span class="p">(:)=</span><span class="mi">31</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">a</span><span class="o">&gt;</span><span class="mi">0</span>
    <span class="k">if</span> <span class="n">b</span><span class="o">&gt;</span><span class="mi">0</span>
        <span class="n">c</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">d</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>r<span class="p">=</span><span class="nf">my_min3</span><span class="p">(</span>x,y,z<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">y</span>
        <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="n">x</span>
            <span class="n">r</span><span class="p">=</span><span class="n">z</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">r</span><span class="p">=</span><span class="n">x</span><span class="p">;</span>
        <span class="k">end</span>
    <span class="k">else</span>
        <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="n">y</span>
            <span class="n">r</span><span class="p">=</span><span class="n">z</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">r</span><span class="p">=</span><span class="n">y</span><span class="p">;</span>
        <span class="k">end</span>
    <span class="k">end</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="use-lower-case-letters-for-variable-names">
<h3><a class="toc-backref" href="#id16">Use lower-case letters for variable names</a><a class="headerlink" href="#use-lower-case-letters-for-variable-names" title="Permalink to this headline">¶</a></h3>
<p>Use underscores (<code class="docutils literal"><span class="pre">_</span></code>) to separate words.</p>
<blockquote>
<div><p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">myVar</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">MyVar</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">My_Var</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">my_var</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="throw-an-informative-error-early">
<h3><a class="toc-backref" href="#id17">Throw an (informative) error early</a><a class="headerlink" href="#throw-an-informative-error-early" title="Permalink to this headline">¶</a></h3>
<p>Throw an error as soon as something seems out of order. When doing so, try to provide an informative error message.</p>
<blockquote>
<div><p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">error</span><span class="p">(</span><span class="s">&#39;What do you mean?&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>This is bad because the user has no idea why an error was thrown.</p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">ntemplate</span><span class="o">~=</span><span class="n">nsamples</span>
    <span class="c">% this is bad because the friggofrag analysis is invalid.</span>
    <span class="c">% Telling the user that they provided wrong input could harm their</span>
    <span class="c">% self-esteem however, so let&#39;s just make up some data that,</span>
    <span class="c">% although completely meaningless, will ensure that the script</span>
    <span class="c">% does not crash.</span>
    <span class="n">samples</span><span class="p">=</span><span class="nb">randn</span><span class="p">(</span><span class="n">ntemplate</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This is very bad because instead of reporting that data was of incorrect
shape, the code generates new (random) data, which the user most likely neither expects or desires.</p>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">error</span><span class="p">(</span><span class="s">&#39;targets have size %d x %d, expected %d % d&#39;</span><span class="p">,</span> <span class="c">...</span>
             <span class="n">target_size</span><span class="p">,</span> <span class="n">expected_target_size</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">caught_exception</span><span class="p">.</span><span class="n">identifier</span><span class="p">,</span><span class="c">...</span>
                    <span class="s">&#39;stats:svmtrain:NoConvergence&#39;</span><span class="p">);</span>
    <span class="n">error</span><span class="p">([</span><span class="s">&#39;SVM training did not converge. Your options are:\n&#39;</span><span class="c">...</span>
           <span class="s">&#39; 1) increase &#39;&#39;boxconstraint&#39;&#39;\n&#39;</span><span class="c">...</span>
           <span class="s">&#39; 2) increase &#39;&#39;tolkkt&#39;&#39;\n&#39;</span><span class="c">...</span>
           <span class="s">&#39; 3) set &#39;&#39;kktviolationlevel&#39;&#39; to a positive value\n&#39;</span><span class="c">...</span>
           <span class="s">&#39; 4) use a different classifier\n&#39;</span><span class="c">...</span>
           <span class="s">&#39;If you do not have a strong preference for &#39;</span><span class="c">...</span>
           <span class="s">&#39;either option, you are advised to try option (4) &#39;</span><span class="c">...</span>
           <span class="s">&#39;using cosmo_classify_lda&#39;</span><span class="p">],</span><span class="s">&#39;&#39;</span><span class="p">);</span>
<span class="k">else</span>
    <span class="n">rethrow</span><span class="p">(</span><span class="n">caught_exception</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="do-not-repeat-yourself">
<h3><a class="toc-backref" href="#id18">Do not repeat yourself</a><a class="headerlink" href="#do-not-repeat-yourself" title="Permalink to this headline">¶</a></h3>
<p>If the same expression is evaluated multiple times, evaluate it once and assign its result to a variable.</p>
<blockquote>
<div><p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">nfeatures</span><span class="o">&gt;</span><span class="n">nsamples</span>
    <span class="n">delta</span><span class="p">=</span><span class="n">nfeatures</span><span class="o">-</span><span class="n">nsamples</span>
<span class="k">else</span>
    <span class="n">delta</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">end</span>

<span class="n">aggregate_size</span><span class="p">=[</span><span class="n">nfeatures</span><span class="p">,</span><span class="n">nsamples</span><span class="p">,</span><span class="n">delta</span><span class="p">];</span>

<span class="k">if</span> <span class="n">nsamples</span><span class="o">&lt;</span><span class="p">=</span><span class="n">nfeatures</span>
    <span class="n">cosmo_warning</span><span class="p">(</span><span class="s">&#39;%d samples &lt; %d features&#39;</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">nfeatures</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>good</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">has_more_features_than_samples</span><span class="p">=</span><span class="n">nfeatures</span><span class="o">&gt;</span><span class="n">nsamples</span>

<span class="k">if</span> <span class="n">has_more_features_than_samples</span>
    <span class="n">delta</span><span class="p">=</span><span class="n">nfeatures</span><span class="o">-</span><span class="n">nsamples</span>
<span class="k">else</span>
    <span class="n">delta</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">end</span>

<span class="n">aggregate_size</span><span class="p">=[</span><span class="n">nfeatures</span><span class="p">,</span><span class="n">nsamples</span><span class="p">,</span><span class="n">delta</span><span class="p">];</span>

<span class="k">if</span> <span class="n">has_more_features_than_samples</span>
    <span class="n">cosmo_warning</span><span class="p">(</span><span class="s">&#39;%d samples &lt; %d features&#39;</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">nfeatures</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="write-in-normal-understandable-english">
<h3><a class="toc-backref" href="#id19">Write in normal, understandable english</a><a class="headerlink" href="#write-in-normal-understandable-english" title="Permalink to this headline">¶</a></h3>
<p>Avoid using capital letters in the documentation, unless you want others to PERCEIVE YOUR MESSAGE AS SHOUTING, normal spelling dictates this (start of a sentence, proper names), tag code, or to refer to variable names. Avoid capital letters for variable names. If possible, give informative error messages.</p>
<blockquote>
<div><p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% NOW RUN THE CROSS-VALIDATION</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">error</span><span class="p">(</span><span class="s">&#39;YOU SERIOUSLY MESSED UP THE INPUT - ARE YOU CRAZY???&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;STARTING ANALYSIS... PLEASE BE PATIENT!!!\n&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">error</span><span class="p">(</span><span class="s">&#39;What do you mean?&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>acceptable:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% Note: this function is EXPERIMENTAL.</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% Note: this function is *** experimental ***.</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% The function Y=abs(X), where X is NxQ, returns an array Y of size NxQ</span>
<span class="c">% so that, assuming that all elements in X are real, Y==X.*sign(X);</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% NNO Sep 2013</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% TODO: support more than two different chunks.</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% Now run the cross-validation</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">show_progress</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Starting analysis - please be patient...\n&#39;</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="document-functions">
<h3><a class="toc-backref" href="#id20">Document functions</a><a class="headerlink" href="#document-functions" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>When writing function definitions:</dt>
<dd><ul class="first simple">
<li>start with a short sentence (one line) describing its purpose.</li>
<li>describe the signature of the function (input and output arguments)</li>
<li>describe the input parameters</li>
<li>describe the output parameters</li>
<li>whenever appropriate, add examples, notes, and references.</li>
</ul>
<p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[winners,classes]<span class="p">=</span><span class="nf">cosmo_winner_indices</span><span class="p">(</span>pred<span class="p">)</span><span class="w"></span>
<span class="c">% uses a pretty cool hack using bsxfun to decide about the winners!</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="last highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[winners,classes]<span class="p">=</span><span class="nf">cosmo_winner_indices</span><span class="p">(</span>pred<span class="p">)</span><span class="w"></span>
<span class="c">% Given multiple predictions, get indices that were predicted most often.</span>
<span class="c">%</span>
<span class="c">% [winners,classes]=cosmo_winner_indices(pred)</span>
<span class="c">%</span>
<span class="c">% Input:</span>
<span class="c">%   pred              PxQ prediction values for Q features and P</span>
<span class="c">%                     predictions per feature. Values of NaN are ignored,</span>
<span class="c">%                     i.e. can never be a winner.</span>
<span class="c">%</span>
<span class="c">% Output:</span>
<span class="c">%   winners           Px1 indices of classes that occur most often.</span>
<span class="c">%                     winners(k)==w means that no value in</span>
<span class="c">%                     classes(pred(k,:)) occurs more often than classes(w).</span>
<span class="c">%   classes           The sorted list of unique predicted values, across</span>
<span class="c">%                     all non-ignored (non-NaN) values in pred.</span>
<span class="c">%</span>
<span class="c">% Examples:</span>
<span class="c">%     % a single prediction, with the third one missing</span>
<span class="c">%     pred=[4; 4; NaN; 5];</span>
<span class="c">%     [p, c]=cosmo_winner_indices(pred);</span>
<span class="c">%     p&#39;</span>
<span class="c">%     &gt; [1 1 NaN 2]</span>
<span class="c">%     c&#39;</span>
<span class="c">%     &gt; [4, 5]</span>
<span class="c">%</span>
<span class="c">%     % one prediction per fold (e.g. using cosmo_nfold_partitioner)</span>
<span class="c">%     pred=[4 NaN NaN; 6 NaN NaN; NaN 3 NaN; NaN NaN NaN; NaN NaN 3];</span>
<span class="c">%     [p, c]=cosmo_winner_indices(pred);</span>
<span class="c">%     p&#39;</span>
<span class="c">%     &gt; [2, 3, 1, NaN, 1]</span>
<span class="c">%     c&#39;</span>
<span class="c">%     &gt; [3 4 6]</span>
<span class="c">%</span>
<span class="c">%     % given up to three predictions each for eight samples, compute</span>
<span class="c">%     % which predictions occur most often. NaNs are ignored.</span>
<span class="c">%     pred=[4 4 4;4 5 6;6 5 4;5 6 4;4 5 6; NaN NaN NaN; 6 0 0;0 0 NaN];</span>
<span class="c">%     [p, c]=cosmo_winner_indices(pred);</span>
<span class="c">%     p&#39;</span>
<span class="c">%     &gt; [2, 3, 4, 2, 3, NaN, 1, 1]</span>
<span class="c">%     c&#39;</span>
<span class="c">%     &gt; [0, 4, 5, 6]</span>
<span class="c">%</span>
<span class="c">% Notes:</span>
<span class="c">% - The typical use case is combining results from multiple classification</span>
<span class="c">%   predictions, such as in binary support vector machines (SVMs) and</span>
<span class="c">%   cosmo_crossvalidate</span>
<span class="c">% - The current implementation selects a winner pseudo-randomly (but</span>
<span class="c">%   deterministically) and (presumably) unbiased in case of a tie between</span>
<span class="c">%   multiple winners. That is, using the present implementation, repeatedly</span>
<span class="c">%   calling this function with identical input yields identical output,</span>
<span class="c">%   but unbiased with respect to which class is the &#39;winner&#39; sample-wise.</span>
<span class="c">% - Samples with no predictions are assigned a value of NaN.</span>
<span class="c">%</span>
<span class="c">% See also: cosmo_classify_matlabsvm, cosmo_crossvalidate</span>
<span class="c">%</span>
<span class="c">% #   For CoSMoMVPA&#39;s copyright information and license terms,   #</span>
<span class="c">% #   see the COPYING file distributed with CoSMoMVPA.           #</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="pre-allocate-space-for-data">
<h3><a class="toc-backref" href="#id21">Pre-allocate space for data</a><a class="headerlink" href="#pre-allocate-space-for-data" title="Permalink to this headline">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>Allocate space for output or intermediate results beforehand, rather than let arrays grow in a <code class="docutils literal"><span class="pre">for</span></code> or <code class="docutils literal"><span class="pre">while</span></code> loop.</dt>
<dd><ul class="first simple">
<li>This can greatly improve performance. Growing an array requires reallocating memory, which slows down code execution.</li>
<li>It also indicates what the size of the output is, which can help in understanding what code does.</li>
<li>This guideline is especially important when large arrays of data are used.</li>
</ul>
<p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">ndata</span><span class="p">=</span><span class="nb">size</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">accs</span><span class="p">=[];</span> <span class="c">% start with empty array, then let it grow</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ndata</span><span class="p">;</span>
    <span class="n">acc</span><span class="p">=</span><span class="n">a_func</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="n">k</span><span class="p">,:))</span> <span class="c">% compute accuracy</span>
    <span class="n">accs</span><span class="p">=[</span><span class="n">acss</span> <span class="n">acc</span><span class="p">];</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="last highlight-matlab"><div class="highlight"><pre><span></span><span class="n">ndata</span><span class="p">=</span><span class="nb">size</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">accs</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ndata</span><span class="p">);</span> <span class="c">% allocate space for output</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ndata</span>
    <span class="n">acc</span><span class="p">=</span><span class="n">a_func</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="n">k</span><span class="p">,:))</span> <span class="c">% compute accuracy</span>
    <span class="n">accs</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">acc</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="use-vectorization">
<h3><a class="toc-backref" href="#id22">Use vectorization</a><a class="headerlink" href="#use-vectorization" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>When possible use vectorization rather than a <code class="docutils literal"><span class="pre">for</span></code> or <code class="docutils literal"><span class="pre">while</span></code> loop.</dt>
<dd><ul class="first simple">
<li>Many functions support vectorized functions, where the same function is applied to elements in arrays.</li>
<li>Vectorization reduces the number of lines of code.</li>
<li>Vectorization typically reduces execution time.</li>
</ul>
<p><strong>really bad:</strong> (see previous guideline)</p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">]=</span><span class="nb">size</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

<span class="n">abs_data</span><span class="p">=[];</span> <span class="c">% start with empty array, then let it grow</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nrows</span>
    <span class="n">row_abs_data</span><span class="p">=[];</span> <span class="c">% absolute data for the k-th row</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ncols</span>
        <span class="n">row_abs_data</span><span class="p">=[</span><span class="n">row_abs_data</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="nb">j</span><span class="p">))];</span>
    <span class="k">end</span>
    <span class="n">abs_data</span><span class="p">=[</span><span class="n">abs_data</span><span class="p">;</span> <span class="n">row_abs_data</span><span class="p">];</span> <span class="c">% add this row to the output</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">]=</span><span class="nb">size</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

<span class="n">abs_data</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">);</span> <span class="c">% allocate space for output</span>

<span class="c">% compute absolute value for each value in data</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nrows</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ncols</span>
        <span class="n">abs_data</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="nb">j</span><span class="p">)=</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="nb">j</span><span class="p">));</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="last highlight-matlab"><div class="highlight"><pre><span></span><span class="n">abs_data</span><span class="p">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="use-clear-variable-names">
<h3><a class="toc-backref" href="#id23">Use clear variable names</a><a class="headerlink" href="#use-clear-variable-names" title="Permalink to this headline">¶</a></h3>
<p>The aim is to find a good balance between length and readability. Short variable names are fine if their use is clear (e.g., <code class="docutils literal"><span class="pre">i</span></code>, <code class="docutils literal"><span class="pre">j</span></code>, <code class="docutils literal"><span class="pre">k</span></code> for loop variables; <code class="docutils literal"><span class="pre">n</span></code> for number of elements, <code class="docutils literal"><span class="pre">f</span></code> for a function). It is recommended to document what a statement does if this cannot be deduced easily from the variable/function names.</p>
<blockquote>
<div><p><em>Note:</em> <code class="docutils literal"><span class="pre">i</span></code> and <code class="docutils literal"><span class="pre">j</span></code> are used in Matlab to indicate the imagery unit (for which it holds that <code class="docutils literal"><span class="pre">i^2==-1</span></code>), but for functions that do not use complex numbers (currently all of them) their use as a loop variable is acceptable.</p>
<p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">msxs</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">hkrw8ingmuch</span> <span class="p">=</span> <span class="n">max</span><span class="p">([</span><span class="n">v</span><span class="p">,</span><span class="n">vv</span><span class="p">,</span><span class="n">vvv</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">my_very_long_variable_name_that_describes_something_i_forgot</span> <span class="p">=</span> <span class="c">...</span>
    <span class="n">apply_function_work</span><span class="p">(</span><span class="n">with_a_very_long_argument_name</span><span class="p">,</span><span class="c">...</span>
                        <span class="n">and_another_long_argument_name</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>borderline acceptable:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% get the indices of the sample mask</span>
<span class="n">msxs</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">nf</span><span class="p">]=</span><span class="nb">size</span><span class="p">(</span><span class="n">ds</span><span class="p">.</span><span class="n">samples</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">mask_indices</span><span class="p">=</span><span class="nb">find</span><span class="p">(</span><span class="n">sample_mask</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">max_dimen</span><span class="p">=</span><span class="n">max</span><span class="p">([</span><span class="n">x_dim</span><span class="p">,</span> <span class="n">y_dim</span><span class="p">,</span> <span class="n">z_dim</span><span class="p">]);</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">sliced_ds</span><span class="p">=</span><span class="n">cosmo_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">mask_indices</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">n</span><span class="p">=</span><span class="nb">size</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="c">% number of samples</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span>
    <span class="n">data_result</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">f</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="n">k</span><span class="p">,:));</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">nsamples</span><span class="p">,</span> <span class="n">nfeatures</span><span class="p">]=</span><span class="nb">size</span><span class="p">(</span><span class="n">ds</span><span class="p">.</span><span class="n">samples</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="avoid-side-effects">
<h3><a class="toc-backref" href="#id24">Avoid side effects</a><a class="headerlink" href="#avoid-side-effects" title="Permalink to this headline">¶</a></h3>
<p>Generally try to avoid side effects, and if that is not possible, indicate such effects clearly in the function name.</p>
<blockquote>
<div><p><strong>very bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">init_my_toolbox</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">restoredefaultpath</span><span class="p">();</span>
    <span class="n">addpath</span><span class="p">(</span><span class="s">&#39;my_functions&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The above is bad because:</p>
<blockquote>
<div><ul class="simple">
<li>The function name <code class="docutils literal"><span class="pre">init_my_toolbox</span></code> does something one would not expect based on its name, namely it resets the Matlab path.</li>
<li>Functions that were accessible before are not longer in the Matlab path. In particular, any other external toolboxes or code not part of the Matlab installation becomes unavailable.</li>
</ul>
</div></blockquote>
<p>It is acceptable to add something to the Matlab path, if the function name clearly indicates that it does so:</p>
<p><strong>acceptable:</strong></p>
<blockquote>
<div><div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">my_toolbox_set_path</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">addpath</span><span class="p">(</span><span class="s">&#39;my_functions&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="use-oncleanup-if-an-earlier-state-needs-to-be-reset">
<h3><a class="toc-backref" href="#id25">Use onCleanup if an earlier state needs to be reset</a><a class="headerlink" href="#use-oncleanup-if-an-earlier-state-needs-to-be-reset" title="Permalink to this headline">¶</a></h3>
<p>In general, functions should not change the current working directory, the path, or the warning state. Sometimes this cannot be avoided, but in that case these changes should be undone when leaving the function using <code class="docutils literal"><span class="pre">onCleanup</span></code>. <code class="docutils literal"><span class="pre">try</span></code> - <code class="docutils literal"><span class="pre">catch</span></code> constructions should be avoided.</p>
<blockquote>
<div><p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">do_computation</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">addpath</span><span class="p">(</span><span class="s">&#39;my_functions&#39;</span><span class="p">);</span>
    <span class="n">original_dir</span><span class="p">=</span><span class="n">pwd</span><span class="p">();</span>
    <span class="n">cd</span><span class="p">(</span><span class="s">&#39;other_functions/private&#39;</span><span class="p">);</span>
    <span class="n">warning</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">);</span>

    <span class="n">do_stuff</span><span class="p">();</span>

    <span class="n">rmpath</span><span class="p">(</span><span class="s">&#39;my_functions&#39;</span><span class="p">);</span>
    <span class="n">cd</span><span class="p">(</span><span class="n">original_dir</span><span class="p">);</span>
    <span class="n">warning</span><span class="p">(</span><span class="s">&#39;on&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The above is bad, because:</p>
<blockquote>
<div><ul class="simple">
<li>the user may have added <code class="docutils literal"><span class="pre">my_functions</span></code> to the path themselves; after calling this function, it is removed from the path.</li>
<li>the user may have set the warning state themselves to <code class="docutils literal"><span class="pre">off</span></code>; this is undone after calling this funciton</li>
<li>the current working directory and the path are not restored when execution is interrupted because of an error or a user interrupt (<code class="docutils literal"><span class="pre">ctrl+C</span></code>).</li>
</ul>
</div></blockquote>
<p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">do_computation</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">original_path</span><span class="p">=</span><span class="n">path</span><span class="p">();</span>
    <span class="n">original_dir</span><span class="p">=</span><span class="n">pwd</span><span class="p">();</span>

    <span class="k">try</span>
        <span class="n">addpath</span><span class="p">(</span><span class="s">&#39;my_functions&#39;</span><span class="p">);</span>
        <span class="n">cd</span><span class="p">(</span><span class="s">&#39;other_functions/private&#39;</span><span class="p">);</span>

        <span class="n">do_stuff</span><span class="p">();</span>

    <span class="k">catch</span>
        <span class="n">e</span><span class="p">=</span><span class="n">lasterror</span><span class="p">();</span>

        <span class="n">cd</span><span class="p">(</span><span class="n">original_path</span><span class="p">);</span>
        <span class="n">path</span><span class="p">(</span><span class="n">original_path</span><span class="p">);</span>

        <span class="n">rethrow</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="k">end</span>

    <span class="n">cd</span><span class="p">(</span><span class="n">original_path</span><span class="p">);</span>
    <span class="n">path</span><span class="p">(</span><span class="n">original_path</span><span class="p">);</span>
</pre></div>
</div>
<p>Although the path and pwd are restored, this is bad because:</p>
<blockquote>
<div><ul class="simple">
<li>it introduces code duplication.</li>
<li>it does not protect against the user pressing ctrl+c.</li>
</ul>
</div></blockquote>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">do_computation</span><span class="p">()</span><span class="w"></span>

<span class="w">   </span><span class="n">original_path</span><span class="p">=</span><span class="n">path</span><span class="p">();</span>
   <span class="n">original_working_dir</span><span class="p">=</span><span class="n">pwd</span><span class="p">();</span>
   <span class="n">original_warning_state</span><span class="p">=</span><span class="n">warning</span><span class="p">();</span>

   <span class="n">path_resetter</span><span class="p">=</span><span class="n">onCleanup</span><span class="p">(@()</span><span class="n">cd</span><span class="p">(</span><span class="n">original_path</span><span class="p">));</span>
   <span class="n">working_dir_resetter</span><span class="p">=</span><span class="n">onCleanup</span><span class="p">(@()</span><span class="n">path</span><span class="p">(</span><span class="n">original_working_dir</span><span class="p">));</span>
   <span class="n">warning_state_resetter</span><span class="p">=</span><span class="n">onCleanup</span><span class="p">(@()</span><span class="n">warning</span><span class="p">(</span><span class="n">original_warning_state</span><span class="p">));</span>

   <span class="n">addpath</span><span class="p">(</span><span class="s">&#39;my_functions&#39;</span><span class="p">);</span>
   <span class="n">warning</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">);</span>

   <span class="n">cd</span><span class="p">(</span><span class="s">&#39;other_functions/private&#39;</span><span class="p">);</span>

   <span class="n">do_stuff</span><span class="p">();</span>

   <span class="c">% (the path, working directory, and warning state are reset when</span>
   <span class="c">%  execution of the code in the function body is completed or</span>
   <span class="c">%  interrupted.)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="tests-should-not-require-user-interaction">
<h3><a class="toc-backref" href="#id26">Tests should not require user interaction</a><a class="headerlink" href="#tests-should-not-require-user-interaction" title="Permalink to this headline">¶</a></h3>
<p>When implementing unit tests (in the <code class="docutils literal"><span class="pre">tests</span></code>) directory, functions should run automatically without any user interaction. If a test were to require user interaction, one of the main advantages of the test suite (fully automated testing) is lost.</p>
</div>
<div class="section" id="do-not-use-global-variables">
<h3><a class="toc-backref" href="#id27">Do not use global variables</a><a class="headerlink" href="#do-not-use-global-variables" title="Permalink to this headline">¶</a></h3>
<p>Global variables can have nasty and unpredictable side effects. Therefore, CoSMoMVPA does not use global variables. In almost all cases it is preferable that output of a function should depend on the input only; there are some exceptions, such as <a class="reference internal" href="matlab/cosmo_warning.html#cosmo-warning"><span class="std std-ref">cosmo warning</span></a> which by default shows each warning only once. If necessary (e.g. for caching), use persistent variables.</p>
</div>
<div class="section" id="avoid-long-and-complicated-expressions">
<h3><a class="toc-backref" href="#id28">Avoid long and complicated expressions</a><a class="headerlink" href="#avoid-long-and-complicated-expressions" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Avoid long expressions with many nested parentheses; rather use multiple lines in which variables (with informative names) are assigned in succession. Although this carries a minor speed penalty in Matlab, it improves readability.</p>
<blockquote>
<div><p><strong>borderline acceptable:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">npartitions</span>
    <span class="n">test_indices</span><span class="p">{</span><span class="nb">j</span><span class="p">}=</span><span class="nb">find</span><span class="p">(</span><span class="n">chunk_idx2count</span><span class="p">(</span><span class="n">combis</span><span class="p">(</span><span class="nb">j</span><span class="p">,:)));</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">npartitions</span>
    <span class="n">combi</span><span class="p">=</span><span class="n">combis</span><span class="p">(</span><span class="nb">j</span><span class="p">,:);</span>
    <span class="n">sample_count</span><span class="p">=</span><span class="n">chunk_idx2count</span><span class="p">(</span><span class="n">combi</span><span class="p">);</span>
    <span class="n">test_indices</span><span class="p">{</span><span class="nb">j</span><span class="p">}=</span><span class="nb">find</span><span class="p">(</span><span class="n">sample_count</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="use-sprintf-or-fprint-when-formatting-strings">
<h3><a class="toc-backref" href="#id29">Use <code class="docutils literal"><span class="pre">sprintf</span></code> or <code class="docutils literal"><span class="pre">fprint</span></code> when formatting strings</a><a class="headerlink" href="#use-sprintf-or-fprint-when-formatting-strings" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">When formatting strings use <code class="docutils literal"><span class="pre">sprintf</span></code> or <code class="docutils literal"><span class="pre">fprintf</span></code>, rather than <code class="docutils literal"><span class="pre">num2str</span></code> and string concatenation. Avoid using disp when printing strings; use <code class="docutils literal"><span class="pre">fprintf</span></code> instead.</p>
<blockquote>
<div><p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">([</span><span class="s">&#39;Accuracy for &#39;</span> <span class="n">label</span> <span class="s">&#39; is &#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">mean_value</span><span class="p">)</span> <span class="s">&#39; +/-&#39;</span> <span class="c">...</span>
            <span class="n">num2str</span><span class="p">(</span><span class="n">std_value</span><span class="p">)]);</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Accuracy for %s is %.3f +/- %.3f\n&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">mean_value</span><span class="p">,</span> <span class="n">std_value</span><span class="p">);</span>
</pre></div>
</div>
<p><em>Note</em>: newer Matlab versions provide <code class="docutils literal"><span class="pre">strjoin</span></code>, but for compatibility reasons with older versions, an alternative implementation is provided as <code class="docutils literal"><span class="pre">cosmo_strjoin</span></code>.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="avoid-using-eval">
<h3><a class="toc-backref" href="#id30">Avoid using <code class="docutils literal"><span class="pre">eval</span></code></a><a class="headerlink" href="#avoid-using-eval" title="Permalink to this headline">¶</a></h3>
<p>Statements with <code class="docutils literal"><span class="pre">eval</span></code> can obfuscate the code considerably, and also make refactoring (such as changing variable names) more difficult. In almost all cases code can rewritten that avoids eval. If necessary use function handles.</p>
<blockquote>
<div><p><strong>very bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% for even samples apply f_even, for odd ones f_odd</span>
<span class="n">results</span><span class="p">=[];</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nsamples</span>
    <span class="k">if</span> <span class="nb">mod</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>
        <span class="n">eval</span><span class="p">([</span><span class="s">&#39;results=[results; f_even(data(&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="s">&#39;))];&#39;</span><span class="p">]);</span>
    <span class="k">else</span>
        <span class="n">eval</span><span class="p">([</span><span class="s">&#39;results=[results; f_odd(data(&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="s">&#39;))];&#39;</span><span class="p">]);</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">This</span> <span class="n">is</span> <span class="n">bad</span> <span class="n">because</span> <span class="n">it</span> <span class="n">uses</span> ``<span class="n">eval</span>`` <span class="n">and</span> <span class="n">does</span> <span class="n">not</span> <span class="n">pre</span><span class="o">-</span><span class="n">allocate</span> <span class="n">space</span> <span class="k">for</span> <span class="n">data</span><span class="p">.</span>
</pre></div>
</div>
<p><strong>bad:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% for even samples apply f_even, for odd ones f_odd</span>
<span class="n">results</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">nsamples</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">f_names</span><span class="p">={</span><span class="s">&#39;f_odd&#39;</span><span class="p">,</span><span class="s">&#39;f_even&#39;</span><span class="p">};</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nsamples</span>
    <span class="n">f_index</span><span class="p">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">f_name</span><span class="p">=</span><span class="n">f_names</span><span class="p">{</span><span class="n">f_index</span><span class="p">};</span>
    <span class="n">eval</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;results(%d)=%s(data(%d));&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">f_name</span><span class="p">,</span> <span class="n">k</span><span class="p">));</span>
<span class="k">end</span>

<span class="n">This</span> <span class="n">is</span> <span class="n">bad</span> <span class="n">because</span> <span class="n">it</span> <span class="n">uses</span> ``<span class="n">eval</span>``<span class="p">.</span>
</pre></div>
</div>
<p><strong>good:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% for even samples apply f_even, for odd ones f_odd</span>
<span class="n">results</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">nsamples</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">f_handles</span><span class="p">={@</span><span class="n">f_odd</span><span class="p">,</span> <span class="p">@</span><span class="n">f_even</span><span class="p">};</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nsamples</span>
    <span class="n">f_index</span><span class="p">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">f_handle</span><span class="p">=</span><span class="n">f_handles</span><span class="p">{</span><span class="n">f_index</span><span class="p">};</span>
    <span class="n">f_data</span><span class="p">=</span><span class="n">f_handle</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
<span class="k">end</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="minimize-using-try-and-catch">
<h3><a class="toc-backref" href="#id31">Minimize using <code class="docutils literal"><span class="pre">try</span></code> and <code class="docutils literal"><span class="pre">catch</span></code></a><a class="headerlink" href="#minimize-using-try-and-catch" title="Permalink to this headline">¶</a></h3>
<p>The use <code class="docutils literal"><span class="pre">try</span></code> and <code class="docutils literal"><span class="pre">catch</span></code> statements is generally avoided; we aim to throw an exception when the input to a function is wrong. Consider that code for use in a Mars rover should never crash even in unexcepted circumstances, whereas in <a class="reference external" href="http://cosmomvpa.org">CoSMoMVPA</a> the code is aimed at analysis of neuroscience data, where getting correct results is very important (and knowing that something is wrong is important too). Some current exceptions are:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="matlab/cosmo_publish_run_scripts.html#cosmo-publish-run-scripts"><span class="std std-ref">cosmo publish run scripts</span></a>, that builds the <a class="reference external" href="http://www.mathworks.com/products/matlab/">Matlab</a> output from the scripts in <code class="docutils literal"><span class="pre">examples/</span></code>. We don&#8217;t want that function to crash if any of the scripts it is publishing crashes.</li>
<li><a class="reference internal" href="matlab/cosmo_classify_libsvm.html#cosmo-classify-libsvm"><span class="std std-ref">cosmo classify libsvm</span></a> and <a class="reference internal" href="matlab/cosmo_classify_matlabsvm.html#cosmo-classify-matlabsvm"><span class="std std-ref">cosmo classify matlabsvm</span></a>, that check whether the required externals are present if they fail, as that is a likely scenarion. In that case, even though the error is caught initially, always a subsequent error is thrown.</li>
<li><a class="reference internal" href="matlab/cosmo_searchlight.html#cosmo-searchlight"><span class="std std-ref">cosmo searchlight</span></a>, which if an error is thrown by the <cite>measure</cite> function handle, prefixes the error message with the feature id that caused the error, and then throws a new error.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="no-private-functions">
<h3><a class="toc-backref" href="#id32">No private functions</a><a class="headerlink" href="#no-private-functions" title="Permalink to this headline">¶</a></h3>
<p>Do not use private functions. If functions are considered useful enough for one particular function, it may also be useful for other functions or for the users.</p>
</div>
<div class="section" id="no-file-duplication">
<h3><a class="toc-backref" href="#id33">No file duplication</a><a class="headerlink" href="#no-file-duplication" title="Permalink to this headline">¶</a></h3>
<p>Do not duplicate files in multiple locations. Doing so would add additional maintenance burden in keeping all files up to date.</p>
</div>
<div class="section" id="check-input-arguments">
<h3><a class="toc-backref" href="#id34">Check input arguments</a><a class="headerlink" href="#check-input-arguments" title="Permalink to this headline">¶</a></h3>
<p>Generally it is good to check the input arguments, although there is a subjective component in deciding how much should be checked, or when an error should be thrown. Checking more means less concise code and longer execution times, but can also prevent the user from making mistakes that would otherwise go undetected.</p>
</div>
</div>
<div class="section" id="cosmomvpa-specific-guidelines">
<h2><a class="toc-backref" href="#id11">CoSMoMVPA-specific guidelines</a><a class="headerlink" href="#cosmomvpa-specific-guidelines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="writing-exercises">
<h3>Writing exercises<a class="headerlink" href="#writing-exercises" title="Permalink to this headline">¶</a></h3>
<p>To indicate that a code block is an exercise, place a line containing <code class="docutils literal"><span class="pre">%</span> <span class="pre">&gt;&#64;&#64;&gt;</span></code> before the block and one containing <code class="docutils literal"><span class="pre">%</span> <span class="pre">&lt;&#64;&#64;&lt;</span></code> after the block. When using the build system (see above), this will replace the corresponding block by a message saying <code class="docutils literal"><span class="pre">%%%%</span> <span class="pre">Your</span> <span class="pre">code</span> <span class="pre">comes</span> <span class="pre">here</span> <span class="pre">%%%%</span></code> in the online documentation.</p>
<blockquote>
<div><p><strong>example:</strong></p>
<div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="c">% set the training and test indices for each chunk</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nchunks</span>
    <span class="c">% &gt;@@&gt;</span>
    <span class="n">test_msk</span><span class="p">=</span><span class="n">unq</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="n">chunks</span><span class="p">;</span>
    <span class="n">train_indices</span><span class="p">{</span><span class="n">k</span><span class="p">}=</span><span class="nb">find</span><span class="p">(</span><span class="o">~</span><span class="n">test_msk</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span>
    <span class="n">test_indices</span><span class="p">{</span><span class="n">k</span><span class="p">}=</span><span class="nb">find</span><span class="p">(</span><span class="n">test_msk</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span>
    <span class="c">% &lt;@@&lt;</span>
<span class="k">end</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="documentation-tests">
<h3>Documentation tests<a class="headerlink" href="#documentation-tests" title="Permalink to this headline">¶</a></h3>
<p>When providing examples it is a good idea to write them in the shape of examples, so that running <a class="reference internal" href="matlab/cosmo_run_tests.html#cosmo-run-tests"><span class="std std-ref">cosmo run tests</span></a> will actually test whether the code runs as advertised. (Note: this requires Matlab&#8217;s xunit). Many <a class="reference external" href="matindex.html">modules</a> have such doctests; you can spot them in the <code class="docutils literal"><span class="pre">Examples:</span></code> section of the help info, where the expected output is preceded by <code class="docutils literal"><span class="pre">&gt;</span></code>. For example:</p>
<blockquote>
<div><div class="highlight-matlab"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[split, nsplit]<span class="p">=</span><span class="nf">cosmo_strsplit</span><span class="p">(</span>string, delim, varargin<span class="p">)</span><span class="w"></span>
<span class="c">% splits a string based on another delimeter string</span>
<span class="c">%</span>
<span class="c">% [split,n]=cosmo_strsplit(string[,delim,][pos1, delim2, pos2, delim2,...])</span>
<span class="c">%</span>
<span class="c">% Inputs:</span>
<span class="c">%   string          input to be split</span>
<span class="c">%   delim           delimiter string. delim can contain backslash-escaped</span>
<span class="c">%                   characters that are interpreted by sprintf; for</span>
<span class="c">%                   example &#39;\t&#39;, &#39;\n&#39; and &#39;\\&#39; represent a tab, newline</span>
<span class="c">%                   and backslash character, respectively.</span>
<span class="c">%                   If omitted or equal to [], then the string is split</span>
<span class="c">%                   based on whitespaces occuring in string</span>
<span class="c">%</span>
<span class="c">%   pos             (optional) a single index indicating which split part</span>
<span class="c">%                   should be returned. If string is split in N elements,</span>
<span class="c">%                   then a negative value for pos is equivalent to pos+1+N</span>
<span class="c">%                   (similar to Python). For example, pos=-1 means that the</span>
<span class="c">%                   last element is returned, and pos=-2 means that the</span>
<span class="c">%                   element before the last element is returned.</span>
<span class="c">%                   If omitted a cell with all parts are returned.</span>
<span class="c">%   delim*          (optional) subsequent delimeters applied after applying</span>
<span class="c">%                   pos. It requires that the preceding pos has a single</span>
<span class="c">%                   value.</span>
<span class="c">%</span>
<span class="c">% Output:</span>
<span class="c">%   split           when the last argument is non-positional, split is a</span>
<span class="c">%                   cell with the string split by delim. When there are N</span>
<span class="c">%                   non-overlapping occurences of delim in string, then</span>
<span class="c">%                   split has N+1 elements, and the string</span>
<span class="c">%                   [delim split{1} delim split{2} ... split{N} delim]</span>
<span class="c">%                   is equal to string.</span>
<span class="c">%                   If the last argument is positional, then split is</span>
<span class="c">%                   a string with value split_{pos} where split_ is the</span>
<span class="c">%                   result if pos where not the last arugment.</span>
<span class="c">%   n               the number of elements in split, if split is a cell;</span>
<span class="c">%                   0 otherwise</span>
<span class="c">%</span>
<span class="c">% Examples:</span>
<span class="c">%   % split by &#39;*&#39;</span>
<span class="c">%   cosmo_strsplit(&#39;A*AbbAbA*AbA*A*Ab&#39;,&#39;*&#39;)</span>
<span class="c">%   &gt;      &#39;A&#39;    &#39;AbbAbA&#39;    &#39;AbA&#39;    &#39;A&#39;    &#39;Ab&#39;</span>
<span class="c">%</span>
<span class="c">%   % split by &#39;A*A&#39;</span>
<span class="c">%   cosmo_strsplit(&#39;A*AbbAbA*AbA*A*Ab&#39;,&#39;A*A&#39;)</span>
<span class="c">%   &gt;   &#39;&#39;    &#39;bbAb&#39;    &#39;b&#39;    &#39;*Ab&#39;</span>
<span class="c">%</span>
<span class="c">%   % take second element after split</span>
<span class="c">%   cosmo_strsplit(&#39;A*AbbAbA*AbA*A*Ab&#39;,&#39;A*A&#39;,2)</span>
<span class="c">%   &gt;  bbAb</span>
<span class="c">%</span>
<span class="c">%   % get last element after split</span>
<span class="c">%   cosmo_strsplit(&#39;A*AbbAbA*AbA*A*Ab&#39;,&#39;A*A&#39;,-1)</span>
<span class="c">%   &gt;  *Ab</span>
<span class="c">%</span>
<span class="c">%   % split twice, first on &#39;A*A&#39;, take second element, then on &#39;A&#39;</span>
<span class="c">%   cosmo_strsplit(&#39;A*AbbAbA*AbA*A*Ab&#39;,&#39;A*A&#39;,2,&#39;A&#39;)</span>
<span class="c">%   &gt;     &#39;bb&#39;    &#39;b&#39;</span>
<span class="c">%</span>
<span class="c">%   % take first element after second split</span>
<span class="c">%   cosmo_strsplit(&#39;A*AbbAbA*AbA*A*Ab&#39;,&#39;A*A&#39;,2,&#39;A&#39;,1)</span>
<span class="c">%   &gt;  bb</span>
<span class="c">%</span>
<span class="c">%   % illustrate effect of not using a delimiter string</span>
<span class="c">%   % (which causes the string to be split by whitespace) and using</span>
<span class="c">%   % a space as delimiter</span>
<span class="c">%   cosmo_strsplit(&#39; CoSMoMVPA makes live...  easy!&#39;)</span>
<span class="c">%   &gt;    &#39;CoSMoMVPA&#39;    &#39;makes&#39;    &#39;live...&#39;    &#39;easy!&#39;</span>
<span class="c">%   cosmo_strsplit(&#39; CoSMoMVPA makes live...  easy!&#39;,&#39; &#39;)</span>
<span class="c">%   &gt;     &#39;&#39;    &#39;CoSMoMVPA&#39;    &#39;makes&#39;    &#39;live...&#39;    &#39;&#39;    &#39;easy!&#39;</span>
<span class="c">%</span>
<span class="c">% #   For CoSMoMVPA&#39;s copyright information and license terms,   #</span>
<span class="c">% #   see the COPYING file distributed with CoSMoMVPA.           #</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="compatibility-notes">
<h3>Compatibility notes<a class="headerlink" href="#compatibility-notes" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://cosmomvpa.org">CoSMoMVPA</a> aims to be compatible with GNU Octave 3.8 and later, and with Matlab versions from at least 2010b onwards.</p>
</div>
</div>
<div class="section" id="test-suite">
<h2><a class="toc-backref" href="#id12">Test suite</a><a class="headerlink" href="#test-suite" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://cosmomvpa.org">CoSMoMVPA</a> uses a test suite, which can automatically test most of the code. This helps in maintaining or improving the quality of the code, and to check whether refactoring code does not introduce undesired changes in behaviour (bugs). Tests are located in <code class="docutils literal"><span class="pre">tests/</span></code> and use the <a class="reference external" href="https://github.com/MOxUnit/MOxUnit">MOxUnit</a> framework. To run them, either:</p>
<blockquote>
<div><ul class="simple">
<li>run <a class="reference internal" href="matlab/cosmo_run_tests.html#cosmo-run-tests"><span class="std std-ref">cosmo run tests</span></a>: when using <a class="reference external" href="http://www.mathworks.com/matlabcentral/fileexchange/22846-matlab-xunit-test-framework">xUnit</a>.</li>
<li>run <code class="docutils literal"><span class="pre">moxunit_run_tests</span></code> in the <code class="docutils literal"><span class="pre">tests</span></code> directory: when using <a class="reference external" href="https://github.com/MOxUnit/MOxUnit">MOxUnit</a>. Supported on the Matlab and Octave platform. Documentation tests are not supported yet.</li>
</ul>
</div></blockquote>
<p>Currently we use <a class="reference external" href="https://travis-ci.org/CoSMoMVPA/CoSMoMVPA">Travis-ci</a> for continuous integration testing and <a class="reference external" href="https://coveralls.io/github/CoSMoMVPA/CoSMoMVPA">coveralls.io</a> with <a class="reference external" href="https://github.com/MOcov/MOcov">MOcov</a> for testing coverage. If you have a <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a> account and a <a class="reference external" href="http://cosmomvpa.org">CoSMoMVPA</a> fork, you can also use it to test new branches. To do so:</p>
<blockquote>
<div><ul class="simple">
<li>Make an account on <cite>Travis-ci</cite>.</li>
<li>Link it to your <a class="reference external" href="https://github.com/CoSMoMVPA/CoSMoMVPA">github</a> account.</li>
<li>Now, after every &#8216;push&#8217; to github, the test suite is run automatically using <code class="docutils literal"><span class="pre">moxunit_run_testa</span></code> on Octave.</li>
<li>If any tests fails, or passes if it failed before, you will be notified by email.</li>
</ul>
</div></blockquote>
<p>When proposing new functionality through a pull request, please include tests that test this functionality.</p>
</div>
<div class="section" id="good-tests">
<h2><a class="toc-backref" href="#id13">Good tests</a><a class="headerlink" href="#good-tests" title="Permalink to this headline">¶</a></h2>
<p>Some general features that make tests good:</p>
<ul class="simple">
<li>expected function mapping: whether output is expected for particular input. It is even better if input is generated randomly and properties of the expected output are tested.</li>
<li>code coverage: check whether different input arguments (for example different switches or options) results in different expected outputs. Code coverage estimates from <a class="reference external" href="https://coveralls.io/github/CoSMoMVPA/CoSMoMVPA">coveralls.io</a> or <a class="reference external" href="https://github.com/MOcov/MOcov">MOcov</a> can be useful in guiding which code needs more testing. Although code coverage is not a goal in itself, as a rule of thumb we like <code class="docutils literal"><span class="pre">80%</span></code> coverage and are very happy with coverage above <code class="docutils literal"><span class="pre">90%</span></code>.</li>
<li>raise exceptions when expcted: test whether wrong or illegal inputs raise an exception (through <code class="docutils literal"><span class="pre">assertExceptionThrown</span></code>).</li>
<li>modular: test one particular function (for unit tests), or whether multiple functions work together as expected (integration test)</li>
<li>no data dependencies: tests that use data as input should generate this data themselves. The <a class="reference internal" href="matlab/cosmo_synthetic_dataset.html#cosmo-synthetic-dataset"><span class="std std-ref">cosmo synthetic dataset</span></a> function can generate data in various modalities and parameters. We aim to not include binary files for testing. For example, some of our input and output tests actually generate files in AFNI, NIFTI, GIFTI and BrainVoyager format.</li>
</ul>
<p>We also like <em>fast</em> tests, because it allows running all tests, or a significant subset, in a short amount of time. This gives quick feedback to the developer whether code works or not, allowing for data-driven development techniques. It also scales well: imagine running 500 tests and each test takes 5 minutes: the suite would take more than a day and a half to run! But even half a minute per test would make take 4 hours, a very long time between implementing a change and getting feedback whether the suite passes.</p>
<p>What is fast then? When running on the Matlab platform (which typically runs a bit faster than Octave), here some rule of thumb for the runtime <code class="docutils literal"><span class="pre">t</span></code> of a test:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">t</span> <span class="pre">&lt;</span> <span class="pre">100</span> <span class="pre">ms</span></code>: excellent.</li>
<li><code class="docutils literal"><span class="pre">100</span> <span class="pre">ms</span> <span class="pre">&lt;</span> <span class="pre">t</span> <span class="pre">&lt;</span> <span class="pre">1</span> <span class="pre">s</span></code>: ok.</li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">s</span> <span class="pre">&lt;</span> <span class="pre">t</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">s</span></code>: borderline acceptable but not preferred.</li>
<li><code class="docutils literal"><span class="pre">5</span> <span class="pre">s</span> <span class="pre">&lt;</span> <span class="pre">t</span> <span class="pre">&lt;</span> <span class="pre">60</span> <span class="pre">s</span></code>: acceptable only in exceptional cases.</li>
<li><code class="docutils literal"><span class="pre">t</span> <span class="pre">&gt;</span> <span class="pre">&gt;</span> <span class="pre">60</span> <span class="pre">s</span></code>: generally not acceptable.</li>
</ul>
<p>One important principle in writing fast tests is using small data, as this generally reduces computation time for most functions. To estimate the runtime for a tests, you can use <code class="docutils literal"><span class="pre">moxunit_runtsts</span></code> with the <code class="docutils literal"><span class="pre">verbose</span></code> option.</p>
<p>For examples of tests, see the <code class="docutils literal"><span class="pre">test</span></code> directory.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/cosmomvpa_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Information for contributors</a><ul>
<li><a class="reference internal" href="#directory-locations-and-naming-conventions">Directory locations and naming conventions</a><ul>
<li><a class="reference internal" href="#meta-naming-conventions-in-the-documentation">Meta - naming conventions in the documentation</a></li>
<li><a class="reference internal" href="#setting-the-matlab-path">Setting the Matlab path</a></li>
<li><a class="reference internal" href="#organization-of-files-and-directories">Organization of files and directories</a></li>
<li><a class="reference internal" href="#setting-up-the-documentation-build-system">Setting up the documentation build system</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#information-for-contributing-programmers">Information for contributing <em>programmers</em></a><ul>
<li><a class="reference internal" href="#code-development">Code development</a><ul>
<li><a class="reference internal" href="#contributing-using-git">Contributing using git</a><ul>
<li><a class="reference internal" href="#initial-git-github-setup">Initial git / github setup</a></li>
<li><a class="reference internal" href="#proposing-a-change-in-the-code-a-k-a-submitting-a-pull-request-pr">Proposing a change in the code (a.k.a. submitting a Pull Request (PR)</a></li>
<li><a class="reference internal" href="#notes-on-committing">Notes on committing</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#build-system">Build system</a></li>
<li><a class="reference internal" href="#matlab-code-guidelines">Matlab code guidelines</a><ul>
<li><a class="reference internal" href="#maximum-line-length-is-75-characters">Maximum line length is 75 characters</a></li>
<li><a class="reference internal" href="#indentation-is-4-spaces-no-tabs">Indentation is 4 spaces (no tabs)</a></li>
<li><a class="reference internal" href="#use-lower-case-letters-for-variable-names">Use lower-case letters for variable names</a></li>
<li><a class="reference internal" href="#throw-an-informative-error-early">Throw an (informative) error early</a></li>
<li><a class="reference internal" href="#do-not-repeat-yourself">Do not repeat yourself</a></li>
<li><a class="reference internal" href="#write-in-normal-understandable-english">Write in normal, understandable english</a></li>
<li><a class="reference internal" href="#document-functions">Document functions</a></li>
<li><a class="reference internal" href="#pre-allocate-space-for-data">Pre-allocate space for data</a></li>
<li><a class="reference internal" href="#use-vectorization">Use vectorization</a></li>
<li><a class="reference internal" href="#use-clear-variable-names">Use clear variable names</a></li>
<li><a class="reference internal" href="#avoid-side-effects">Avoid side effects</a></li>
<li><a class="reference internal" href="#use-oncleanup-if-an-earlier-state-needs-to-be-reset">Use onCleanup if an earlier state needs to be reset</a></li>
<li><a class="reference internal" href="#tests-should-not-require-user-interaction">Tests should not require user interaction</a></li>
<li><a class="reference internal" href="#do-not-use-global-variables">Do not use global variables</a></li>
<li><a class="reference internal" href="#avoid-long-and-complicated-expressions">Avoid long and complicated expressions</a></li>
<li><a class="reference internal" href="#use-sprintf-or-fprint-when-formatting-strings">Use <code class="docutils literal"><span class="pre">sprintf</span></code> or <code class="docutils literal"><span class="pre">fprint</span></code> when formatting strings</a></li>
<li><a class="reference internal" href="#avoid-using-eval">Avoid using <code class="docutils literal"><span class="pre">eval</span></code></a></li>
<li><a class="reference internal" href="#minimize-using-try-and-catch">Minimize using <code class="docutils literal"><span class="pre">try</span></code> and <code class="docutils literal"><span class="pre">catch</span></code></a></li>
<li><a class="reference internal" href="#no-private-functions">No private functions</a></li>
<li><a class="reference internal" href="#no-file-duplication">No file duplication</a></li>
<li><a class="reference internal" href="#check-input-arguments">Check input arguments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cosmomvpa-specific-guidelines">CoSMoMVPA-specific guidelines</a><ul>
<li><a class="reference internal" href="#writing-exercises">Writing exercises</a></li>
<li><a class="reference internal" href="#documentation-tests">Documentation tests</a></li>
<li><a class="reference internal" href="#compatibility-notes">Compatibility notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-suite">Test suite</a></li>
<li><a class="reference internal" href="#good-tests">Good tests</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="contact.html"
                        title="previous chapter">Contact information</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="thanks.html"
                        title="next chapter">Authors</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/contribute.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="thanks.html" title="Authors"
             >next</a> |</li>
        <li class="right" >
          <a href="contact.html" title="Contact information"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CoSMoMVPA</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="documentation.html" >Documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="footer">
       <span class="creativecommons">
          <a href="http://opensource.org/licenses/MIT" >
          <img src="_static/mit-license_logo.png"
               border="0" alt="Creative Commons License"/>
         </a> 
         
        <a href="copyright.html">Copyright 2013-2016 Nikolaas N. Oosterhof, Andrew C. Connolly, CoSMoMVPA contributors</a>.
        CoSMoMVPA is licensed under a <a href="http://opensource.org/licenses/MIT">Expat (MIT) License</a>.
       </span>
      </div>
  </body>
</html>