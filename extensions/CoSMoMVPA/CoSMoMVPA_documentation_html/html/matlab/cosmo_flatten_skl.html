    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cosmo flatten skl &#8212; CoSMo Multivariate Pattern Analysis toolbox 1.0rc1 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0rc1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="cosmo fmri convert xform skl" href="cosmo_fmri_convert_xform_skl.html" />
    <link rel="prev" title="cosmo find local extrema skl" href="cosmo_find_local_extrema_skl.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cosmo_fmri_convert_xform_skl.html" title="cosmo fmri convert xform skl"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cosmo_find_local_extrema_skl.html" title="cosmo find local extrema skl"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CoSMoMVPA</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../cimec2016.html" >CIMeC hands-on methods course, part 1 (6 April-2 May 2016)</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../matindex_skl.html" accesskey="U">CoSMoMVPA functions - skeleton files</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cosmo-flatten-skl">
<span id="id1"></span><h1>cosmo flatten skl<a class="headerlink" href="#cosmo-flatten-skl" title="Permalink to this headline">Â¶</a></h1>
<div class="highlight-matlab"><div class="highlight"><pre><span></span>function ds=cosmo_flatten(arr, dim_labels, dim_values, dim, varargin)
% flattens an arbitrary array to a dataset structure
%
% ds=cosmo_flatten(arr, dim_labels, dim_values, dim[, ...])
%
% Inputs:
%   arr                S_1 x ... x S_K x Q input array if (dim==1), or
%                      P x S_1 x ... x S_K input array if (dim==2)
%   dim_labels         1xK cell containing labels for each dimension but
%                      the first one.
%   dim_values         1xK cell with S_J values (J in 1:K) corresponding to
%                      the labels in each of the K dimensions.
%   dim                dimension along which to flatten, either 1 (samples)
%                      or 2 (features; default)
%   &#39;matrix_labels&#39;,m  Allow labels in the cell string m to be matrices
%                      rather than vectors. Currently the only use case is
%                      the &#39;pos&#39; attribute for MEEG source space data.
%
% Output:
%   ds                 dataset structure, with fields:
%      .samples        PxQ data for P samples and Q features.
%      .a.dim.labels   Kx1 cell with the values in dim_labels
%      .a.dim.values   Kx1 cell with the values in dim_values. The i-th
%                      element has S_i elements along dimension dim
%      .fa.(label)     for each label in a.dim.labels it contains the
%      .samples        PxQ data for P samples and Q features, where
%                      Q=prod(S_*) if dim==1 and P=prod(S_*) if dim==2
%      .a.Xdim.labels  1xK cell with the values in dim_labels (X==&#39;s&#39; if
%                      dim==1, and &#39;f&#39; if dim==2); the M-th element must
%                      have S_M values.
%      .a.Xdim.values  1xK cell with the values in dim_values; the M-th
%                      element must have S_M values.
%      .Xa.(label)     for each label in a.Xdim.labels it contains the
%                      sub-indices for the K dimensions. It is ensured
%                      that for every dimension J in 1:K, all values in
%                      ds.fa.(a.dim.labels{J}) are in the range 1:S_K.
%
% Examples:
%     % typical usage: flatten features in 2x3x5 array, 1 sample
%     data=reshape(1:30, [1 2,3,5]);
%     ds=cosmo_flatten(data,{&#39;i&#39;,&#39;j&#39;,&#39;k&#39;},{1:2,1:3,{&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;}});
%     cosmo_disp(ds)
%     &gt; .samples
%     &gt;   [ 1         2         3  ...  28        29        30 ]@1x30
%     &gt; .fa
%     &gt;   .i
%     &gt;     [ 1 2 1  ...  2 1 2 ]@1x30
%     &gt;   .j
%     &gt;     [ 1 1 2  ...  2 3 3 ]@1x30
%     &gt;   .k
%     &gt;     [ 1 1 1  ...  5 5 5 ]@1x30
%     &gt; .a
%     &gt;   .fdim
%     &gt;     .labels
%     &gt;       { &#39;i&#39;  &#39;j&#39;  &#39;k&#39; }
%     &gt;     .values
%     &gt;       { [ 1 2 ]  [ 1 2 3 ]  { &#39;a&#39;  &#39;b&#39;  &#39;c&#39;  &#39;d&#39;  &#39;e&#39; } }
%
%     % flatten samples in 1x1x2x3 array, 5 features
%     data=reshape(1:30, [1,1,2,3,5]);
%     ds=cosmo_flatten(data,{&#39;i&#39;,&#39;j&#39;,&#39;k&#39;,&#39;m&#39;},{1,&#39;a&#39;,(1:2)&#39;,(1:3)&#39;},1);
%     cosmo_disp(ds);
%     &gt; .samples
%     &gt;   [ 1         7        13        19        25
%     &gt;     2         8        14        20        26
%     &gt;     3         9        15        21        27
%     &gt;     4        10        16        22        28
%     &gt;     5        11        17        23        29
%     &gt;     6        12        18        24        30 ]
%     &gt; .sa
%     &gt;   .i
%     &gt;     [ 1
%     &gt;       1
%     &gt;       1
%     &gt;       1
%     &gt;       1
%     &gt;       1 ]
%     &gt;   .j
%     &gt;     [ 1
%     &gt;       1
%     &gt;       1
%     &gt;       1
%     &gt;       1
%     &gt;       1 ]
%     &gt;   .k
%     &gt;     [ 1
%     &gt;       2
%     &gt;       1
%     &gt;       2
%     &gt;       1
%     &gt;       2 ]
%     &gt;   .m
%     &gt;     [ 1
%     &gt;       1
%     &gt;       2
%     &gt;       2
%     &gt;       3
%     &gt;       3 ]
%     &gt; .a
%     &gt;   .sdim
%     &gt;     .labels
%     &gt;       { &#39;i&#39;  &#39;j&#39;  &#39;k&#39;  &#39;m&#39; }
%     &gt;     .values
%     &gt;       { [ 1 ]  &#39;a&#39;  [ 1    [ 1
%     &gt;                       2 ]    2
%     &gt;                              3 ] }
%
%
% Notes:
%   - Intended use is for flattening fMRI or MEEG datasets
%   - This function is the inverse of cosmo_unflatten.
%
% See also: cosmo_unflatten, cosmo_fmri_dataset, cosmo_meeg_dataset
%
% #   For CoSMoMVPA&#39;s copyright information and license terms,   #
% #   see the COPYING file distributed with CoSMoMVPA.           #

    defaults.matrix_labels=cell(0);
    opt=cosmo_structjoin(defaults,varargin{:});

    if nargin&lt;4, dim=2; end

    switch dim
        case 1
            do_transpose=true;
            attr_name=&#39;sa&#39;;
            dim_name=&#39;sdim&#39;;
        case 2
            do_transpose=false;
            attr_name=&#39;fa&#39;;
            dim_name=&#39;fdim&#39;;
        otherwise
            error(&#39;illegal dim: must be 1 or 2&#39;);
    end

    if do_transpose
        % switch samples and features
        ndim=numel(dim_labels);
        nfeatures=size(arr,ndim+1);
        if nfeatures==1
            arr=reshape(arr,[1 size(arr)]);
        else
            arr=shiftdim(arr,ndim);
        end
        dim_values=cellfun(@transpose,dim_values,&#39;UniformOutput&#39;,false);
    end

    [samples,dim_values,attr]=flatten_features(arr, dim_labels, ...
                                            dim_values, opt);

    if do_transpose
        samples=samples&#39;;
        attr=transpose_attr(attr);
        dim_values=cellfun(@transpose,dim_values,&#39;UniformOutput&#39;,false);
    end

    ds=struct();
    ds.samples=samples;
    ds.(attr_name)=attr;
    ds.a.(dim_name).labels=dim_labels;
    ds.a.(dim_name).values=dim_values;

function attr=transpose_attr(attr)
    keys=fieldnames(attr);
    for k=1:numel(keys)
        key=keys{k};
        value=attr.(key);
        attr.(key)=value&#39;;
    end

function [samples,dim_values,attr]=flatten_features(arr, dim_labels, ...
                                                        dim_values, opt)
    % helper function to flatten features

    ndim=numel(dim_labels);
    if ndim ~= numel(dim_values)
        error(&#39;expected %d dimensions, found %d&#39;,ndim,numel(dim_values));
    elseif numel(size(arr))&gt;(ndim+1)
        error(&#39;Array has %d dimensions, expected &lt;= %d&#39;,...
                                        numel(size(arr)),ndim+1);
    end


    % allocate space for output
    attr=struct();

    % number of values in remaining dimensions
    % (supports the case that arr is of size [...,1]
    [dim_sizes,dim_values]=get_dim_sizes(arr,dim_labels,dim_values,opt);

    for dim=1:ndim
        % set values for dim-th dimension
        dim_label=dim_labels{dim};
        dim_value=dim_values{dim};

        nvalues=size(dim_value,2);

        % set the indices
        indices=1:nvalues;

        % make an array lin_values that has size 1 in every dimension
        % except for the &#39;dim&#39;-th one, where it has size &#39;nvalues&#39;.
        singleton_size=ones(1,ndim);
        singleton_size(dim)=nvalues;
        if ndim==1
            % reshape only works with &gt;=2 dimensions
            lin_values=indices;
        else
            lin_values=reshape(indices,singleton_size);
        end

        % now the lin_values have to be tiled (using repmat). The number of
        % repeats is &#39;dim_sizes&#39;(&#39;k&#39;) for all &#39;k&#39; except for &#39;dim&#39;,
        % where it is 1 (as it has &#39;nvalues&#39; in that dimension already).
        rep_size=dim_sizes;
        rep_size(dim)=1;

        rep_values=repmat(lin_values, rep_size(:)&#39;);

        % store indices as a row vector.
        attr.(dim_label)=reshape(rep_values, 1, []);
    end

    % get array and sample sizes
    nsamples=size(arr,1);
    nfeatures=prod(dim_sizes);

    samples=reshape(arr, nsamples, nfeatures);


function [dim_sizes, dim_values]=get_dim_sizes(arr,dim_labels,dim_values,opt)
    ndim=numel(dim_values);
    dim_sizes=zeros(1,ndim);

    for dim=1:ndim
        dim_label=dim_labels{dim};
        dim_value=dim_values{dim};

        if cosmo_match({dim_label},opt.matrix_labels)
            dim_size=size(dim_value,2);
        else
            if ~isvector(dim_value)
                error([&#39;Label &#39;&#39;%s&#39;&#39; (dimension %d) must be a vector, &#39;...
                        &#39;because it was not specified as a matrix &#39;...
                        &#39;dimension in the &#39;&#39;matrix_fields&#39;&#39; option&#39;],...
                        dim_label, dim);
            end
            dim_size=numel(dim_value);
            dim_values{dim}=dim_value(:)&#39;; % make it a row vector
        end


        if dim_size ~= size(arr,dim+1)
            error([&#39;Label &#39;&#39;%s&#39;&#39; (dimension %d) has %d values, &#39;,...
                        &#39;expected %d based on the array input&#39;],...
                    dim_label, dim, dim_size, size(arr,dim+1));
        end

        dim_sizes(dim)=dim_size;
    end
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/cosmomvpa_logo.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="cosmo_find_local_extrema_skl.html"
                        title="previous chapter">cosmo find local extrema skl</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cosmo_fmri_convert_xform_skl.html"
                        title="next chapter">cosmo fmri convert xform skl</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/matlab/cosmo_flatten_skl.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="cosmo_fmri_convert_xform_skl.html" title="cosmo fmri convert xform skl"
             >next</a> |</li>
        <li class="right" >
          <a href="cosmo_find_local_extrema_skl.html" title="cosmo find local extrema skl"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CoSMoMVPA</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../cimec2016.html" >CIMeC hands-on methods course, part 1 (6 April-2 May 2016)</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../matindex_skl.html" >CoSMoMVPA functions - skeleton files</a> &#187;</li> 
      </ul>
    </div>
      <div class="footer">
       <span class="creativecommons">
          <a href="http://opensource.org/licenses/MIT" >
          <img src="../_static/mit-license_logo.png"
               border="0" alt="Creative Commons License"/>
         </a> 
         
        <a href="copyright.html">Copyright 2013-2016 Nikolaas N. Oosterhof, Andrew C. Connolly, CoSMoMVPA contributors</a>.
        CoSMoMVPA is licensed under a <a href="http://opensource.org/licenses/MIT">Expat (MIT) License</a>.
       </span>
      </div>
  </body>
</html>