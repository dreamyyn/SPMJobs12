
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>MEEG time generalization in a region (in space-time) of interest</title><meta name="generator" content="MATLAB 8.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-12-01"><meta name="DC.source" content="run_meeg_time_generalization.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>MEEG time generalization in a region (in space-time) of interest</h1><!--introduction--><p>This example shows MVPA analyses performed on MEEG data.</p><p>The input dataset involved a paradigm where a participant saw images of six object categories.</p><p>The code presented here can be adapted for other MEEG analyses, but there are a few potential caveats: * assignment of chunks (parts of the data that are assumed to be   independent) is based on a trial-by-trial basis. For cross-validation,   the number of chunks is reduced to two to speed up the analysis. * the current examples do not perform baseline corrections or signal   normalizations, which may reduce discriminatory power.</p><p>Note: running this code requires FieldTrip.</p><div><ol><li>For CoSMoMVPA's copyright information and license terms,   #</li><li>see the COPYING file distributed with CoSMoMVPA.           #</li></ol></div><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">get timelock data in CoSMoMVPA format</a></li><li><a href="#3">Select subset of sensors and time points</a></li><li><a href="#4">Visualize results</a></li></ul></div><h2>get timelock data in CoSMoMVPA format<a name="1"></a></h2><pre class="codeinput"><span class="comment">% set configuration</span>
config=cosmo_config();
data_path=fullfile(config.tutorial_data_path,<span class="string">'meg_obj6'</span>);

<span class="comment">% show dataset information</span>
readme_fn=fullfile(data_path,<span class="string">'README'</span>);
cosmo_type(readme_fn);

<span class="comment">% reset citation list</span>
cosmo_check_external(<span class="string">'-tic'</span>);

<span class="comment">% load preprocessed data</span>
data_fn=fullfile(data_path,<span class="string">'meg_obj6_s00.mat'</span>);
data_tl=load(data_fn);

<span class="comment">% convert to cosmomvpa struct and show the dataset</span>
ds=cosmo_meeg_dataset(data_tl);
cosmo_disp(ds);
</pre><pre class="codeoutput">******************************************************************************
MEG responses to a human participant viewing pictures of six object categories
******************************************************************************

Contents
--------
- meg_obj6_s00.mat
    Preprecessed data from four runs in Matlab / GNU Octave format.
    Data is stored in a FieldTrip structure with the following relevant
    fields:

    + .trial 
        n_samples * n_sensors * n_time array with single trial data
    + .time
        1 * n_time vector of time relative to stimulus onset.
    + .label
        1 * n_sensors cell array with MEG channel labels.
    + .trialinfo
        n_time * 6 matrix with trial information; the columns represent:

        1) stimulus category in the range `(1:6)`, with the order
           being 'body','car','face','flower','insect','scene'. 
        2) stimulus index in the range `(1:48)`.
        3) unused.
        4) cumulative number of catch trials in the current run.
        5) stimulus presentation duration (in miliseconds).
        6) run number.

    In the current release, n_samples=494, n_sensors=295, n_time=301.
      
Version
-------
version 0.1, 26 April 2016

Methods
-------
This dataset contains data from an experiment where a participant 
(32y right-handed male) viewed images of six categories while being measured
with MEG. Over four runs, trials were presented at a rate of 1Hz while the
participant performed a one-back task. Blocks of eight trials where separated
by blink periods to reduce eye movement artefaces. 
Data was preprocessed using the FieldTrip toolbox [OFMS11].
Data was bandpass-filtered between 1Hz and 40Hz, resampled from 1000Hz to
250Hz, and baseline period for the period of -250 to -50 ms relative to (i.e.
before) stimulus onset.
Based on visual inspection, trials and sensors that seemed noisy were removed.
Catch trials (trials were the stimulus was repeated relative to the previous
trial) were also removed.


License
-------
The contents are made available by Nikolaas N. Oosterhof &lt;nikolaas.oosterhof 
|at| unitn.it&gt; under the Creative Commons CC0 1.0 Universal Public Domain 
Dedication ("CC0"). See the LICENSE file for details, or visit 
http://creativecommons.org/publicdomain/zero/1.0/deed.en.


Download
--------
A zip file with all data is available from the CoSMoMVPA_ website [OCH16]:

  http://www.cosmomvpa.org/datadb-meg_obj6.zip

.. _CoSMoMVPA: http://www.cosmomvpa.org


Contact
-------
Nikolaas N. Oosterhof &lt;nikolaas.oosterhof |at| unitn.it&gt;


References
----------
:ref:`Oostenveld, R., Fries, P., Maris, E., and Schoffelen, J.-M. (2011) &lt;OFMS11&gt;` FieldTrip: Open source software for advanced analysis of MEG, EEG, and invasive electrophysiological data.. Computational Intelligence and Neuroscience, 2011:156869.

:ref:`Oosterhof, N. N., Connolly, A. C., and Haxby, J. V. (2016) &lt;OCH16&gt;`. CoSMoMVPA: multi-modal multivariate pattern analysis of neuroimaging data in Matlab / GNU Octave. biorxiv.org, 2016. doi:10.1101/047118.

.samples                                                                                 
  [ -3.42e-12  1.32e-12  6.77e-12  ...   2.91e-12  1.02e-11     1e-12                    
     1.78e-12  1.42e-12 -2.35e-12  ...  -3.67e-12  -5.4e-12     7e-15                    
     7.84e-12  1.71e-13 -6.44e-13  ...  -2.88e-13  2.25e-12   1.2e-13                    
        :         :         :               :          :         :                       
    -2.46e-12 -1.41e-16  2.27e-12  ...  -5.81e-13  -6.2e-12  2.74e-13                    
     -7.9e-12   4.2e-12  4.11e-12  ...  -5.62e-12  7.64e-12  1.98e-13                    
    -2.32e-13 -2.49e-12  7.39e-12  ...   2.08e-12  -8.5e-12  2.42e-13 ]@494x88795        
.fa                                                                                      
  .chan                                                                                  
    [ 1         2         3  ...  293       294       295 ]@1x88795                      
  .time                                                                                  
    [ 1         1         1  ...  301       301       301 ]@1x88795                      
.a                                                                                       
  .fdim                                                                                  
    .labels                                                                              
      { 'chan'                                                                           
        'time' }                                                                         
    .values                                                                              
      { { 'MEG0113'  'MEG0112'  'MEG0123' ... 'MEG2642'  'MEG2643'  'MEG2641'   }@1x295  
        [ -0.296    -0.292    -0.288  ...  0.896       0.9     0.904 ]@1x301            }
  .meeg                                                                                  
    .samples_field                                                                       
      'trial'                                                                            
.sa                                                                                      
  .trialinfo                                                                             
    [ 4        28         0         1       142         1                                
      3        18         0         2       147         1                                
      2        15         0         2       147         1                                
      :         :         :         :        :          :                                
      6        47         0        23       142         4                                
      4        28         0        24       146         4                                
      3        18         0        24       147         4 ]@494x6                        
</pre><pre class="codeinput"><span class="comment">% set the targets (trial condition)</span>
<span class="comment">% Hint: use the first column from ds.sa.trialinfo</span>
<span class="comment">% &gt;@@&gt;</span>
ds.sa.targets=ds.sa.trialinfo(:,1); <span class="comment">% 6 categories</span>
<span class="comment">% &lt;@@&lt;</span>

<span class="comment">% set the chunks (independent measurements)</span>
<span class="comment">% all trials are here considered to be independent</span>
<span class="comment">% &gt;@@&gt;</span>
nsamples=size(ds.samples,1);
ds.sa.chunks=(1:nsamples)';
<span class="comment">% &lt;@@&lt;</span>

<span class="comment">% in addition give a label to each trial</span>
index2label={<span class="string">'body'</span>,<span class="string">'car'</span>,<span class="string">'face'</span>,<span class="string">'flower'</span>,<span class="string">'insect'</span>,<span class="string">'scene'</span>};
ds.sa.labels=cellfun(@(x)index2label(x),num2cell(ds.sa.targets));

<span class="comment">% just to check everything is ok</span>
cosmo_check_dataset(ds);
</pre><h2>Select subset of sensors and time points<a name="3"></a></h2><pre class="codeinput"><span class="comment">% Select posterior gradiometers</span>
sensor_posterior_planar={<span class="string">'MEG1632'</span>, <span class="string">'MEG1642'</span>, <span class="string">'MEG1732'</span>, <span class="string">'MEG1842'</span>, <span class="keyword">...</span>
                        <span class="string">'MEG1912'</span>, <span class="string">'MEG1922'</span>, <span class="string">'MEG1942'</span>, <span class="string">'MEG2232'</span>, <span class="keyword">...</span>
                        <span class="string">'MEG2312'</span>, <span class="string">'MEG2322'</span>, <span class="string">'MEG2342'</span>, <span class="string">'MEG2432'</span>, <span class="keyword">...</span>
                        <span class="string">'MEG2442'</span>, <span class="string">'MEG2512'</span>, <span class="string">'MEG2532'</span>,<span class="keyword">...</span>
                        <span class="string">'MEG1633'</span>, <span class="string">'MEG1643'</span>, <span class="string">'MEG1733'</span>, <span class="string">'MEG1843'</span>, <span class="keyword">...</span>
                        <span class="string">'MEG1913'</span>, <span class="string">'MEG1923'</span>, <span class="string">'MEG1943'</span>, <span class="string">'MEG2233'</span>, <span class="keyword">...</span>
                        <span class="string">'MEG2313'</span>, <span class="string">'MEG2323'</span>, <span class="string">'MEG2343'</span>, <span class="string">'MEG2433'</span>, <span class="keyword">...</span>
                        <span class="string">'MEG2443'</span>, <span class="string">'MEG2513'</span>, <span class="string">'MEG2533'</span>};

msk=cosmo_dim_match(ds,<span class="string">'chan'</span>,sensor_posterior_planar,<span class="keyword">...</span>
                        <span class="string">'time'</span>,@(t)t&gt;=0 &amp; t&lt;=.3);

ds_sel=cosmo_slice(ds,msk,2);
ds_sel=cosmo_dim_prune(ds_sel);

<span class="comment">% Reduce the number of chunks to have only two chunks</span>
<span class="comment">% Hint: use cosmo_chunkize</span>
<span class="comment">% &gt;@@&gt;</span>
ds_sel.sa.chunks=cosmo_chunkize(ds_sel,2);
<span class="comment">% &lt;@@&lt;</span>

<span class="comment">% Now use cosmo_dim_transpose to make 'time' a sample dimension</span>
<span class="comment">% Hint: the third argument to cosmo_dim_transpose must be 1, because</span>
<span class="comment">% time now describes the first (sample) dimension in .samples</span>
<span class="comment">% &gt;@@&gt;</span>
ds_tr=cosmo_dim_transpose(ds_sel,<span class="string">'time'</span>,1);
<span class="comment">% &lt;@@&lt;</span>



<span class="comment">% Set the measure to be a function handle to</span>
<span class="comment">% cosmo_dim_generalization_measure</span>
measure=@cosmo_dim_generalization_measure;

<span class="comment">% Set measure arguments</span>
measure_args=struct();

<span class="comment">% Use the measure with the following arugments:</span>
<span class="comment">% - measure: @cosmo_crossvalidation_measure</span>
<span class="comment">% - classifier: @cosmo_classify_lda</span>
<span class="comment">% - dimension: 'time'</span>
measure_args.measure=@cosmo_crossvalidation_measure;
measure_args.classifier=@cosmo_classify_lda;
measure_args.dimension=<span class="string">'time'</span>;

<span class="comment">% Now apply the measure to the dataset, and store the output in a variable</span>
<span class="comment">% 'result'</span>
result=measure(ds_tr,measure_args);
</pre><pre class="codeoutput">+00:01:16 [####################] -00:00:00  5776 / 5776
</pre><h2>Visualize results<a name="4"></a></h2><pre class="codeinput"><span class="comment">% Unflatten the dataset using cosmo_unflatten, and assign the result</span>
<span class="comment">% to three variables: data, labels and values</span>
<span class="comment">% Hint: the second argument to cosmo_unflatten must be 1</span>

<span class="comment">% &gt;@@&gt;</span>
[data,labels,values]=cosmo_unflatten(result,1);
<span class="comment">% &lt;@@&lt;</span>

<span class="comment">% Visualize the data matrix using imagesc</span>
<span class="comment">% &gt;@@&gt;</span>
imagesc(data,[0 0.5]);
<span class="comment">% &lt;@@&lt;</span>
colorbar();

<span class="comment">% Show labels</span>
nticks=5;
ytick=round(linspace(1, numel(values{1}), nticks));
ylabel(strrep(labels{1},<span class="string">'_'</span>,<span class="string">' '</span>));
set(gca,<span class="string">'Ytick'</span>,ytick,<span class="string">'YTickLabel'</span>,values{1}(ytick));

xtick=round(linspace(1, numel(values{2}), nticks));
xlabel(strrep(labels{2},<span class="string">'_'</span>,<span class="string">' '</span>));
set(gca,<span class="string">'Xtick'</span>,xtick,<span class="string">'XTickLabel'</span>,values{2}(xtick));
</pre><img vspace="5" hspace="5" src="run_meeg_time_generalization_01.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2015a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% MEEG time generalization in a region (in space-time) of interest
%
% This example shows MVPA analyses performed on MEEG data.
%
% The input dataset involved a paradigm where a participant saw
% images of six object categories.
%
% The code presented here can be adapted for other MEEG analyses, but
% there are a few potential caveats:
% * assignment of chunks (parts of the data that are assumed to be
%   independent) is based on a trial-by-trial basis. For cross-validation,
%   the number of chunks is reduced to two to speed up the analysis.
% * the current examples do not perform baseline corrections or signal
%   normalizations, which may reduce discriminatory power.
%
% Note: running this code requires FieldTrip.
%
% #   For CoSMoMVPA's copyright information and license terms,   #
% #   see the COPYING file distributed with CoSMoMVPA.           #


%% get timelock data in CoSMoMVPA format

% set configuration
config=cosmo_config();
data_path=fullfile(config.tutorial_data_path,'meg_obj6');

% show dataset information
readme_fn=fullfile(data_path,'README');
cosmo_type(readme_fn);

% reset citation list
cosmo_check_external('-tic');

% load preprocessed data
data_fn=fullfile(data_path,'meg_obj6_s00.mat');
data_tl=load(data_fn);

% convert to cosmomvpa struct and show the dataset
ds=cosmo_meeg_dataset(data_tl);
cosmo_disp(ds);


%%

% set the targets (trial condition)
% Hint: use the first column from ds.sa.trialinfo
% >@@>
ds.sa.targets=ds.sa.trialinfo(:,1); % 6 categories
% <@@<

% set the chunks (independent measurements)
% all trials are here considered to be independent
% >@@>
nsamples=size(ds.samples,1);
ds.sa.chunks=(1:nsamples)';
% <@@<

% in addition give a label to each trial
index2label={'body','car','face','flower','insect','scene'};
ds.sa.labels=cellfun(@(x)index2label(x),num2cell(ds.sa.targets));

% just to check everything is ok
cosmo_check_dataset(ds);

%% Select subset of sensors and time points

% Select posterior gradiometers
sensor_posterior_planar={'MEG1632', 'MEG1642', 'MEG1732', 'MEG1842', ...
                        'MEG1912', 'MEG1922', 'MEG1942', 'MEG2232', ...
                        'MEG2312', 'MEG2322', 'MEG2342', 'MEG2432', ...
                        'MEG2442', 'MEG2512', 'MEG2532',...
                        'MEG1633', 'MEG1643', 'MEG1733', 'MEG1843', ...
                        'MEG1913', 'MEG1923', 'MEG1943', 'MEG2233', ...
                        'MEG2313', 'MEG2323', 'MEG2343', 'MEG2433', ...
                        'MEG2443', 'MEG2513', 'MEG2533'};

msk=cosmo_dim_match(ds,'chan',sensor_posterior_planar,...
                        'time',@(t)t>=0 & t<=.3);

ds_sel=cosmo_slice(ds,msk,2);
ds_sel=cosmo_dim_prune(ds_sel);

% Reduce the number of chunks to have only two chunks
% Hint: use cosmo_chunkize
% >@@>
ds_sel.sa.chunks=cosmo_chunkize(ds_sel,2);
% <@@<

% Now use cosmo_dim_transpose to make 'time' a sample dimension
% Hint: the third argument to cosmo_dim_transpose must be 1, because
% time now describes the first (sample) dimension in .samples
% >@@>
ds_tr=cosmo_dim_transpose(ds_sel,'time',1);
% <@@<



% Set the measure to be a function handle to
% cosmo_dim_generalization_measure
measure=@cosmo_dim_generalization_measure;

% Set measure arguments
measure_args=struct();

% Use the measure with the following arugments:
% - measure: @cosmo_crossvalidation_measure
% - classifier: @cosmo_classify_lda
% - dimension: 'time'
measure_args.measure=@cosmo_crossvalidation_measure;
measure_args.classifier=@cosmo_classify_lda;
measure_args.dimension='time';

% Now apply the measure to the dataset, and store the output in a variable
% 'result'
result=measure(ds_tr,measure_args);

%% Visualize results

% Unflatten the dataset using cosmo_unflatten, and assign the result
% to three variables: data, labels and values
% Hint: the second argument to cosmo_unflatten must be 1

% >@@>
[data,labels,values]=cosmo_unflatten(result,1);
% <@@<

% Visualize the data matrix using imagesc
% >@@>
imagesc(data,[0 0.5]);
% <@@<
colorbar();

% Show labels
nticks=5;
ytick=round(linspace(1, numel(values{1}), nticks));
ylabel(strrep(labels{1},'_',' '));
set(gca,'Ytick',ytick,'YTickLabel',values{1}(ytick));

xtick=round(linspace(1, numel(values{2}), nticks));
xlabel(strrep(labels{2},'_',' '));
set(gca,'Xtick',xtick,'XTickLabel',values{2}(xtick));

##### SOURCE END #####
--></body></html>