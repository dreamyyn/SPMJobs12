
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Demo: fMRI searchlights with split-half correlations, classifier, and representational similarity analysis</title><meta name="generator" content="MATLAB 8.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-12-01"><meta name="DC.source" content="demo_fmri_correlation_searchlight.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Demo: fMRI searchlights with split-half correlations, classifier, and representational similarity analysis</h1><!--introduction--><p>The data used here is available from <a href="http://cosmomvpa.org/datadb.zip">http://cosmomvpa.org/datadb.zip</a></p><p>This example uses the following dataset: - 'ak6' is based on the following work (please cite if you use it):    Connolly et al (2012), Representation of biological classes in the    human brain. Journal of Neuroscience,    doi 10.1523/JNEUROSCI.5547-11.2012</p><pre>  Six categories (monkey, lemur, mallard, warbler, ladybug, lunamoth)
  during ten runs in an fMRI study. Using the General Linear Model
  response were estimated for each category in each run, resulting
  in 6*10=60 t-values.</pre><div><ol><li>For CoSMoMVPA's copyright information and license terms,   #</li><li>see the COPYING file distributed with CoSMoMVPA.           #</li></ol></div><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Set data paths</a></li><li><a href="#2">Example: split-half correlation measure (Haxby 2001-style)</a></li></ul></div><h2>Set data paths<a name="1"></a></h2><p>The function cosmo_config() returns a struct containing paths to tutorial data. (Alternatively the paths can be set manually without using cosmo_config.)</p><pre class="codeinput">config=cosmo_config();

ak6_study_path=fullfile(config.tutorial_data_path,<span class="string">'ak6'</span>);

<span class="comment">% show readme information</span>
readme_fn=fullfile(ak6_study_path,<span class="string">'README'</span>);
cosmo_type(readme_fn);

<span class="comment">% reset citation list</span>
cosmo_check_external(<span class="string">'-tic'</span>);

<span class="comment">% set result directory</span>
output_path=config.output_data_path;
</pre><pre class="codeoutput">   #    #    #        #####     ######                      
  # #   #   #        #     #    #     #   ##   #####   ##   
 #   #  #  #         #          #     #  #  #    #    #  #  
#     # ###    ##### ######     #     # #    #   #   #    # 
####### #  #         #     #    #     # ######   #   ###### 
#     # #   #        #     #    #     # #    #   #   #    # 
#     # #    #        #####     ######  #    #   #   #    # 

Overview
--------
fMRI responses to viewing images of six species in the animal kingdom, 
used in Connollly et al. 2012.

Contents
--------

- s0[1-8]/                  This directory contains fMRI data from 8 of the 12 
                            participants studied in the experiment reported in 
                            Connolly et al. 2012 (Code-named 'AK6' for animal
                            kingdom, 6-species). Each subject's subdirectory 
                            contains the following data:
   - glm_T_stats_perrun.nii A 60-volume file of EPI-data preprocessed using 
                            AFNI up to and including fitting a general linear 
                            model using 3dDeconvolve. Each volume contains the 
                            t-statistics for the estimated response to a one 
                            of the 6 stimulus categories. These estimates were
                            calculated independently for each of the 10 runs 
                            in the experiment. 
   - glm_T_stats_even.nii   Data derived from glm_T_stats_perrun.nii.
   - glm_T_stats_odd.nii    Each is a 6-volume file with the T-values averaged
                            across even and odd runs for each category.
   - brain.nii              Skull-stripped T1-weighted anatomical brain image.
   - brain_mask.nii         Whole-brain mask in EPI-space/resolution.
   - vt_mask.nii            Bilateral ventral temporal cortex mask similar to 
                            that used in Connolly et al. 2012.
   - ev_mask.nii            Bilateral early visual cortex mask.
- models
   - behav_sim.mat          Matlab file with behavioural similarity ratings.
   - v1_model.mat           Matlab file with similarity values based on 
                            low-level visual properties of the stimuli.

Methods
-------
The stimulus-specific volumes in the stats T-stats file are in the order

    monkey, lemur, mallard (duck), warbler, ladybug, lunamoth

for each of the ten runs.

Reference
---------
When using this dataset for any publication please cite:

Connolly, A. C. , Guntupalli, J. S. , Gors, J. , Hanke, M. , Halchenko, Y. O., 
Wu, Y. , Abdi, H. and Haxby, J. V. (2012). Representation of biological classes 
in the human brain. Journal of Neuroscience, 32, 2608-2618. 
[PDF] DOI: 10.1523/JNEUROSCI.5547-11.2012,

Contact
-------
Andrew C. Connolly &lt;andrew.c.connolly |at| dartmouth.edu&gt;

</pre><h2>Example: split-half correlation measure (Haxby 2001-style)<a name="2"></a></h2><pre class="codeinput"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="comment">% This example uses the 'ak6' dataset</span>

<span class="comment">% define data filenames &amp; load data from even and odd runs</span>

data_path=fullfile(ak6_study_path,<span class="string">'s01'</span>); <span class="comment">% data from subject s01</span>
mask_fn=fullfile(data_path, <span class="string">'brain_mask.nii'</span>); <span class="comment">% whole brain mask</span>

data_odd_fn=fullfile(data_path,<span class="string">'glm_T_stats_odd.nii'</span>);
ds_odd=cosmo_fmri_dataset(data_odd_fn,<span class="string">'mask'</span>,mask_fn,<span class="keyword">...</span>
                            <span class="string">'targets'</span>,1:6,<span class="string">'chunks'</span>,1);


data_even_fn=fullfile(data_path,<span class="string">'glm_T_stats_even.nii'</span>);
ds_even=cosmo_fmri_dataset(data_even_fn,<span class="string">'mask'</span>,mask_fn,<span class="keyword">...</span>
                            <span class="string">'targets'</span>,1:6,<span class="string">'chunks'</span>,2);

<span class="comment">% Combine even and odd runs</span>
ds_odd_even=cosmo_stack({ds_odd, ds_even});

<span class="comment">% print dataset</span>
fprintf(<span class="string">'Dataset input:\n'</span>);
cosmo_disp(ds_odd_even);

<span class="comment">% Use cosmo_correlation_measure.</span>
<span class="comment">% This measure returns, by default, a split-half correlation measure</span>
<span class="comment">% based on the difference of mean correlations for matching and</span>
<span class="comment">% non-matching conditions (a la Haxby 2001).</span>
measure=@cosmo_correlation_measure;

<span class="comment">% define spherical neighborhood with radius of 3 voxels</span>
radius=3; <span class="comment">% voxels</span>
nbrhood=cosmo_spherical_neighborhood(ds_odd_even,<span class="string">'radius'</span>,radius);

<span class="comment">% Run the searchlight with a 3 voxel radius</span>
corr_results=cosmo_searchlight(ds_odd_even,nbrhood,measure);

<span class="comment">% print output</span>
fprintf(<span class="string">'Dataset output:\n'</span>);
cosmo_disp(corr_results);


<span class="comment">% Plot the output</span>
cosmo_plot_slices(corr_results);

<span class="comment">% Define output location</span>
output_fn=fullfile(output_path,<span class="string">'corr_searchlight.nii'</span>);

<span class="comment">% Store results to disc</span>
cosmo_map2fmri(corr_results, output_fn);

<span class="comment">% Show citation information</span>
cosmo_check_external(<span class="string">'-cite'</span>);
</pre><pre class="codeoutput">Dataset input:
.samples                                                                  
  [ -0.0375     0.267      2.71  ...  0.581     0.564      0.55           
      0.145     0.457       1.3  ...  0.158     0.685     0.728           
     -0.269    -0.317      1.59  ...   0.11     0.616    -0.271           
       :         :          :           :         :        :              
     -0.811      -1.1      1.19  ...  0.623     0.244      1.21           
      -0.38   0.00723       1.1  ...   1.69      1.69   -0.0664           
     -0.713      -1.1     0.638  ...  0.622      0.71     0.526 ]@12x43822
.sa                                                                       
  .chunks                                                                 
    [ 1                                                                   
      1                                                                   
      1                                                                   
      :                                                                   
      2                                                                   
      2                                                                   
      2 ]@12x1                                                            
  .targets                                                                
    [ 1                                                                   
      2                                                                   
      3                                                                   
      :                                                                   
      4                                                                   
      5                                                                   
      6 ]@12x1                                                            
.fa                                                                       
  .i                                                                      
    [ 31        32        36  ...  34        35        34 ]@1x43822       
  .j                                                                      
    [ 17        17        17  ...  35        35        36 ]@1x43822       
  .k                                                                      
    [ 1         1         1  ...  39        39        39 ]@1x43822        
.a                                                                        
  .fdim                                                                   
    .labels                                                               
      { 'i'                                                               
        'j'                                                               
        'k' }                                                             
    .values                                                               
      { [ 1         2         3  ...  78        79        80 ]@1x80       
        [ 1         2         3  ...  78        79        80 ]@1x80       
        [ 1         2         3  ...  41        42        43 ]@1x43 }     
  .vol                                                                    
    .mat                                                                  
      [ 3         0         0      -122                                   
        0         3         0      -114                                   
        0         0         3     -11.1                                   
        0         0         0         1 ]                                 
    .xform                                                                
      'scanner_anat'                                                      
    .dim                                                                  
      [ 80        80        43 ]                                          
+00:00:14 [####################] -00:00:00  mean size 111.5
+00:00:43 [####################] -00:00:00  
Dataset output:
.a                                                                       
  .fdim                                                                  
    .labels                                                              
      { 'i'                                                              
        'j'                                                              
        'k' }                                                            
    .values                                                              
      { [ 1         2         3  ...  78        79        80 ]@1x80      
        [ 1         2         3  ...  78        79        80 ]@1x80      
        [ 1         2         3  ...  41        42        43 ]@1x43 }    
  .vol                                                                   
    .mat                                                                 
      [ 3         0         0      -122                                  
        0         3         0      -114                                  
        0         0         3     -11.1                                  
        0         0         0         1 ]                                
    .xform                                                               
      'scanner_anat'                                                     
    .dim                                                                 
      [ 80        80        43 ]                                         
.fa                                                                      
  .nvoxels                                                               
    [ 41        48        52  ...  41        41        38 ]@1x43822      
  .radius                                                                
    [ 3         3         3  ...  3         3         3 ]@1x43822        
  .center_ids                                                            
    [ 1         2         3  ...  4.38e+04  4.38e+04  4.38e+04 ]@1x43822 
  .i                                                                     
    [ 31        32        36  ...  34        35        34 ]@1x43822      
  .j                                                                     
    [ 17        17        17  ...  35        35        36 ]@1x43822      
  .k                                                                     
    [ 1         1         1  ...  39        39        39 ]@1x43822       
.samples                                                                 
  [ 0.0597    0.0884     0.347  ...  0.0876     0.125    0.0789 ]@1x43822
.sa                                                                      
  .labels                                                                
    { 'corr' }                                                           
If you use CoSMoMVPA and/or some other toolboxes for a publication, please cite:

J. Shen. NIFTI toolbox. available online from http://www.mathworks.com/matlabcentral/fileexchange/8797-tools-for-nifti-and-analyze-image

N. N. Oosterhof, A. C. Connolly, J. V. Haxby (2016). CoSMoMVPA: multi-modal multivariate pattern analysis of neuroimaging data in Matlab / GNU Octave. Frontiers in Neuroinformatics, doi:10.3389/fninf.2016.00027.. CoSMoMVPA toolbox available online from http://cosmomvpa.org

The Mathworks, Natick, MA, United States. Matlab 8.5.0.197613 (R2015a) (February 12, 2015). available online from http://www.mathworks.com

</pre><img vspace="5" hspace="5" src="demo_fmri_correlation_searchlight_01.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2015a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Demo: fMRI searchlights with split-half correlations, classifier, and representational similarity analysis
%
% The data used here is available from http://cosmomvpa.org/datadb.zip
%
% This example uses the following dataset:
% - 'ak6' is based on the following work (please cite if you use it):
%    Connolly et al (2012), Representation of biological classes in the
%    human brain. Journal of Neuroscience,
%    doi 10.1523/JNEUROSCI.5547-11.2012
%
%    Six categories (monkey, lemur, mallard, warbler, ladybug, lunamoth)
%    during ten runs in an fMRI study. Using the General Linear Model
%    response were estimated for each category in each run, resulting
%    in 6*10=60 t-values.
%
% #   For CoSMoMVPA's copyright information and license terms,   #
% #   see the COPYING file distributed with CoSMoMVPA.           #



%% Set data paths
% The function cosmo_config() returns a struct containing paths to tutorial
% data. (Alternatively the paths can be set manually without using
% cosmo_config.)
config=cosmo_config();

ak6_study_path=fullfile(config.tutorial_data_path,'ak6');

% show readme information
readme_fn=fullfile(ak6_study_path,'README');
cosmo_type(readme_fn);

% reset citation list
cosmo_check_external('-tic');

% set result directory
output_path=config.output_data_path;


%% Example: split-half correlation measure (Haxby 2001-style)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% This example uses the 'ak6' dataset

% define data filenames & load data from even and odd runs

data_path=fullfile(ak6_study_path,'s01'); % data from subject s01
mask_fn=fullfile(data_path, 'brain_mask.nii'); % whole brain mask

data_odd_fn=fullfile(data_path,'glm_T_stats_odd.nii');
ds_odd=cosmo_fmri_dataset(data_odd_fn,'mask',mask_fn,...
                            'targets',1:6,'chunks',1);


data_even_fn=fullfile(data_path,'glm_T_stats_even.nii');
ds_even=cosmo_fmri_dataset(data_even_fn,'mask',mask_fn,...
                            'targets',1:6,'chunks',2);

% Combine even and odd runs
ds_odd_even=cosmo_stack({ds_odd, ds_even});

% print dataset
fprintf('Dataset input:\n');
cosmo_disp(ds_odd_even);

% Use cosmo_correlation_measure.
% This measure returns, by default, a split-half correlation measure
% based on the difference of mean correlations for matching and
% non-matching conditions (a la Haxby 2001).
measure=@cosmo_correlation_measure;

% define spherical neighborhood with radius of 3 voxels
radius=3; % voxels
nbrhood=cosmo_spherical_neighborhood(ds_odd_even,'radius',radius);

% Run the searchlight with a 3 voxel radius
corr_results=cosmo_searchlight(ds_odd_even,nbrhood,measure);

% print output
fprintf('Dataset output:\n');
cosmo_disp(corr_results);


% Plot the output
cosmo_plot_slices(corr_results);

% Define output location
output_fn=fullfile(output_path,'corr_searchlight.nii');

% Store results to disc
cosmo_map2fmri(corr_results, output_fn);

% Show citation information
cosmo_check_external('-cite');

##### SOURCE END #####
--></body></html>